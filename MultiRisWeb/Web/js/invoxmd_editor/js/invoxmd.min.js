console="undefined"==typeof console?{log:function(e){}}:console;var Status={Disabled:0,Starting:1,Completed:2},__nativeSI__=window.setInterval;window.setInterval=function(e,n){var o=this,t=Array.prototype.slice.call(arguments,2);return __nativeSI__(e instanceof Function?function(){e.apply(o,t)}:e,n)};var invoxmd="undefined"==typeof module?{}:module.exports;!function(){!function(e,n){e.PRODUCTNAME="INVOX Medical",e.version="2.6.4.66",e.commit="8b378bb939ab1dea53ee25514f2ebdad06f8ef95",e.log=function(e){var n=document.getElementById("invox-log");if(n){var o=(new Date).toLocaleTimeString(),t=document.createElement("p"),i=document.createTextNode(o+" "+e);return t.appendChild(i),void n.appendChild(t)}window.console.log("[INFO] - "+e)}}("undefined"==typeof module?this.invoxmd={}:module.exports),function(e,n){var o=e.commandId={};o.NONE=0,o.ACCEPT_TEXT=1,o.ACTIVATE_SPELLING=2,o.ALL_CAPS=3,o.CANCEL_TEMPLATE=4,o.CANCEL_TEXT=5,o.CAPS=6,o.CAPS_ACTIVATE=7,o.CAPS_DEACTIVATE=8,o.CLOSE=9,o.CORRECT=10,o.CORRECT_SELECTION=11,o.DEACTIVATE_SPELLING=12,o.DELETE=13,o.DELETE_NEXT_PARAGRAPH=14,o.DELETE_NEXT_SENTENCE=15,o.DELETE_PREV_PARAGRAPH=16,o.DELETE_PREV_SENTENCE=17,o.DELETE_SELECTION=18,o.DELETE_WORDS=19,o.GO_TO=20,o.GO_TO_AFTER=21,o.GO_TO_BEGINNING_DOC=22,o.GO_TO_BEGINNING_PARAGRAPH=23,o.GO_TO_BEGINNING_SENTENCE=24,o.GO_TO_BOOKMARK=25,o.GO_TO_END_DOC=26,o.GO_TO_END_PARAGRAPH=27,o.GO_TO_END_SENTENCE=28,o.GO_TO_NEXT_FIELD=29,o.GO_TO_NEXT_GROUP=30,o.GO_TO_NEXT_PARAGRAPH=31,o.GO_TO_NEXT_SENTENCE=32,o.GO_TO_PREV_FIELD=33,o.GO_TO_PREV_GROUP=34,o.GO_TO_PREV_PARAGRAPH=35,o.GO_TO_PREV_SENTENCE=36,o.INITIAL_CAPS_ACTIVATE=37,o.INITIAL_CAPS_DEACTIVATE=38,o.MENU=39,o.NEW_REPORT=40,o.NO_CAPS=41,o.REDO=42,o.REDO_WORDS=43,o.SAVE=44,o.SAVE_REPORT=45,o.SELECT=46,o.SELECT_ALL=47,o.SELECT_NEXT_PARAGRAPH=48,o.SELECT_NEXT_SENTENCE=49,o.SELECT_PREV_PARAGRAPH=50,o.SELECT_PREV_SENTENCE=51,o.SELECT_TEMPLATE=52,o.START_DICTATION=53,o.START_REPRODUCTION=54,o.STOP_DICTATION=55,o.STOP_REPRODUCTION=56,o.TABULATION=57,o.UNDO=58,o.UNSELECT=59,o.CAPS_SELECTION=60,o.NORMALIZE_SELECTION=61,o.WHAT_CAN_I_SAY=62,o.CLOSE_WHAT_CAN_I_SAY=63,o.CAPS_INLINE=64,o.NEXT_FIELD=65,o.PREVIOUS_FIELD=66}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.dictationScope={};o.NONE=0,o.CUSTOM=1,o.PAUSED=2,o.RUNNING=3,o.INSTANCE_SELECTION=4,o.CORRECTION=5,o.PHONETIC_TRANSCRIPTION=6,o.SPELLING=7}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.dictationEventType={};o.ACCEPTED=0,o.REJECTED=1,o.PARTIAL=2}(void 0===invoxmd?module.exports:invoxmd),function(e,n){e.exceptionType={NONE:0,UNKNOWN:1,ARGUMENT:2,AUDIO:3,CONNECTION:4,CREDENTIALS:5,DUPLICATE_SESSION:6,ENVIRONMENT:7,INTERNAL:8,INVALID_LICENSE:9,INVALID_OPERATION:10,INVALID_SESSION:11,LANG_MODEL:12,ROLE_VIOLATION:13,VALIDATION:14,CONCURRENT_LICENSE:15,NOT_IMPLEMENTED:16,LDAP_INVALID_USER:17,LDAP_NO_SPECIALTY:18}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.macroType={};o.TEXT=1,o.KEYBOARD=2,o.COMPOSITE=3,o.PAUSE=4,o.MOUSE=5,o.UNKNOWN=6}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.audioStatus={};o.NONE=0,o.NOT_ACCESS=1,o.STARTED=2,o.STOPPED=4}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.sessionAct={};o.UNKNOWN=0,o.LOGIN_GLOBAL_MODEL=1,o.LOGIN_OTHER_GLOBAL=2,o.LOGIN_USER_PROFILE=3,o.LOGIN_OTHER_USER=4,o.LOGOUT_USER_PROFILE=5,o.LOGOUT_OTHER_USER=6,o.INVALID_SESSION=7,o.NET_CONNECTION_OK=8,o.NET_CONNECTION_LOST=9,o.NET_CONNECTION_DUP=10,o.NET_LATENCY_WARNING=11,o.NET_LATENCY_ERROR=12,o.ROLE_VIOLATION=13,o.ROLE_DOWNGRADE=14,o.LOGIN_PREPARING=15,o.LOGIN_DOWNLOADING_RESOURCES=16,o.WEBSOCKET_CLOSED=17}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.sessionState={};o.DISCONNECTED=0,o.CONNECTED=1,o.RECOGNIZER_ENGINE_PAUSED=2,o.RECOGNIZER_ENGINE_RUNNING=3,o.TRAINER_PAUSED=4,o.TRAINER_RUNNING=5,o.RECOGNIZING=6,o.ERROR=7,o.CONNECTING=8}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.controlDeviceAction={};o.NONE=0,o.DEVICE_ADDED=1,o.DEVICE_REMOVED=2,o.ACCEPT_TEXT=3,o.DELETE_WORDS=4,o.GO_TO_BEGINNING_DOC=5,o.GO_TO_BEGINNING_PARAGRAPH=6,o.GO_TO_END_DOC=7,o.GO_TO_END_PARAGRAPH=8,o.GO_TO_NEXT_PARAGRAPH=9,o.GO_TO_PREV_PARAGRAPH=10,o.MOVE_BACKWARD=11,o.MOVE_FORWARD=12,o.MOVE_STOP=13,o.REDO=14,o.REDO_WORDS=15,o.START_DICTATION=16,o.STOP_DICTATION=17,o.SWITCH_DICTATION=18,o.SWITCH_DOC_LOCK=19,o.SWITCH_CAPS_LOCK=20,o.UNDO=21,o.SWITCH_WRITER=22,o.NEXT_FIELD=23,o.PREVIOUS_FIELD=24}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.wsMessage={};o.COMMAND_EVENT="CommandEvent",o.CURRENT_SCOPE_EVENT="CurrentScopeEvent",o.DICTATION_EVENT="DictationEvent",o.END_CORRECTION_EVENT="EndCorrectionEvent",o.INSTANCE_SELECTION_EVENT="InstanceSelectionEvent",o.KEYBOARD_EVENT="KeyboardEvent",o.NEW_CORRECTION_EVENT="NewCorrectionEvent",o.PHONETIC_EVENT="PhoneticEvent",o.SESSION_ACT_EVENT="SessionActEvent",o.SESSION_STATE_EVENT="SessionStateEvent",o.TRAINING_SENTENCE_EVENT="TrainingSentenceEvent",o.CONFIG_SENTENCE_EVENT="ConfigSentenceEvent",o.MICCONFIG_REQUIRED_EVENT="MicConfigRequiredEvent",o.TRAINING_REQUIRED_EVENT="TrainingRequiredEvent",o.CONTROL_DEVICE_EVENT="ControlDeviceEvent",o.LOGIN="Login",o.LOGOUT="Logout",o.CHANGE_PASSWORD="ChangePassword",o.RESET_PASSWORD="ResetPassword",o.DICTIONARY_GET_WORDS="DictionaryGetWords",o.DICTIONARY_GET_WORD="DictionaryGetWord",o.DICTIONARY_ADD_WORD="DictionaryAddWord",o.DICTIONARY_REMOVE_WORD="DictionaryRemoveWord",o.DICTIONARY_REPLACE_WORD="DictionaryReplaceWord",o.MACROS_GET_MACROS="MacrosGetMacros",o.MACROS_GET_GLOBAL_MACROS="MacrosGetGlobalMacros",o.MACROS_ADD_MACRO="MacrosAddMacro",o.MACROS_REMOVE_MACRO="MacrosRemoveMacro",o.MACROS_REPLACE_MACRO="MacrosReplaceMacro",o.RECOGNIZER_ENGINE_START="RecognizerEngineStart",o.RECOGNIZER_ENGINE_STOP="RecognizerEngineStop",o.RECOGNIZER_ENGINE_PLAY="RecognizerEnginePlay",o.RECOGNIZER_ENGINE_PAUSE="RecognizerEnginePause",o.RECOGNIZER_ENGINE_FLUSH="RecognizerEngineFlush",o.RECOGNIZER_ENGINE_SET_FEEDBACK_SUPPRESSION="RecognizerEngineSetFeedbackSuppression",o.RECOGNIZER_ENGINE_ADD_COMMAND_GRAMMAR="RecognizerEngineAddCommandGrammar",o.RECOGNIZER_ENGINE_ADD_LANGUAGE_MODEL="RecognizerEngineAddLanguageModel",o.RECOGNIZER_ENGINE_REMOVE_GRAMMAR="RecognizerEngineRemoveGrammar",o.RECOGNIZER_ENGINE_IS_GRAMMAR_ACTIVE="RecognizerEngineIsGrammarActive",o.RECOGNIZER_ENGINE_ACTIVATE_GRAMMARS="RecognizerEngineActivateGrammars",o.RECOGNIZER_ENGINE_DEACTIVATE_GRAMMARS="RecognizerEngineDeactivateGrammars",o.RECOGNIZER_ENGINE_RESET_GRAMMARS_STATE="RecognizerEngineResetGrammarsState",o.RECOGNIZER_ENGINE_GET_GRAMMARS_STATE="RecognizerEngineGetGrammarsState",o.RECOGNIZER_ENGINE_SET_GRAMMARS_STATE="RecognizerEngineSetGrammarsState",o.RECOGNIZER_ENGINE_GET_RECOGNITION_DETAIL="RecognizerEngineGetRecognitionDetai",o.RECOGNIZER_ENGINE_GET_MAX_ALTERNATES="RecognizerEngineGetMaxAlternates",o.RECOGNIZER_ENGINE_SET_MAX_ALTERNATES="RecognizerEngineSetMaxAlternates",o.RECOGNIZER_ENGINE_EMULATE_RECOGNITION="RecognizerEngineEmulateRecognition",o.TRAINER_START="TrainerStart",o.TRAINER_STOP="TrainerStop",o.TRAINER_PLAY="TrainerPlay",o.TRAINER_PAUSE="TrainerPause",o.TRAINER_RESUME="TrainerResume",o.TRAINER_SET_TRAINING_SENTENCES="TrainerSetTrainingSentences",o.TRAINER_TRAIN_ALTERNATE="TrainerTrainAlternate",o.TRAINER_SET_MICROPHONE_NAME="TrainerSetMicrophoneName",o.RECOGNIZER_START="RecognizerStart",o.RECOGNIZER_STOP="RecognizerStop",o.RECOGNIZER_SET_FEEDBACK_SUPPRESSION="RecognizerSetFeedbackSuppression",o.RECOGNIZER_GET_SCOPE="RecognizerGetScope",o.RECOGNIZER_SET_SCOPE="RecognizerSetScope",o.RECOGNIZER_SET_VISIBLE_TEXT="RecognizerSetVisibleText",o.RECOGNIZER_SET_BOOKMARKS="RecognizerSetBookMarks",o.RECOGNIZER_GET_RECOGNITION_DETAIL="RecognizerGetRecognitionDetail",o.RECOGNIZER_EMULATE_COMMAND="RecognizerEmulateCommand",o.RECOGNIZER_EMULATE_RECOGNITION="RecognizerEmulateRecognition",o.RECOGNIZER_LEARN_NEW_WORDS="RecognizerLearnNewWords",o.GET_USER_INFO="GetUserInfo",o.RESTORE_SESSION="RestoreSession",o.KEEP_ALIVE="KeepAlive",o.SEND_AUDIO_ARRAY="SendAudioArray",o.AUDIO_SOURCE_GET_VOLUME="AudioSourceGetVolume",o.AUDIO_SOURCE_SET_VOLUME="AudioSourceSetVolume",o.AUDIO_SOURCE_GET_LEVEL="AudioSourceGetLevel",o.MISC_GET_VOLUME_SETTINGS="MiscGetVolumeSettings",o.MISC_UPDATE_VOLUME_SETTINGS="MiscUpdateVolumeSettings",o.MIC_GAIN_SET_SENTENCES="MicGainSetSentences",o.MIC_GAIN_START="MicGainStart",o.MIC_GAIN_STOP="MicGainStop",o.RECOGNIZER_HISTORY_GET_CHUNKED_AUDIO="RecognizerHistoryGetChunkedAudio",o.RECORD_AUDIO="RecordAudio",o.UPDATE_PROFILE="UpdateProfile",o.USERITNS_GETUSERITNS="UserITNsGetITNs",o.USERITNS_ADDUSERITN="UserITNsAddITN",o.USERITNS_REMOVEUSERITN="UserITNsRemoveITN",o.USERITNS_REPLACEUSERITN="UserITNsReplaceITN",o.FORMAT_TEXT="FormatText",o.CHECK_REMOTE_DEVICE="CheckRemoteDevice"}(void 0===invoxmd?module.exports:invoxmd),function(e,n){e.microSetupSentenceStatus={NONE:0,NOT_RECOGNIZED:1,IGNORED:2,PARTIALLY_RECOGNIZED:3,RECOGNIZED:4,ERROR:5}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){e.TrainingSentenceStatus={NONE:0,RECOGNIZED:1,NOT_RECOGNIZED:2,IGNORED:3}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){e.FormatCase={NONE:0,NORMAL_CASE:1,UPPER_CASE:2,TITLE_CASE:3,FIRST_CAPITAL:4}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){e.BrowserName={UNKNOWN:"unknow",OPERA:"Opera",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",CHROME:"Chrome",EDGE_CHROME:"Edge Chrome"}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.util={};o.getMessageId=function(){return Math.floor(1e4*Math.random()+1)},o.stringify=function(e){var n=window.Prototype;return n&&n.Version<"1.7"&&Array.prototype.toJSON&&Object.toJSON?Object.toJSON(e):JSON.stringify(e)},o.sendMessage=function(e,n,o,t){var i=invoxmd.util.getMessageId(),s=null==o?"False":this.stringify(o);if(n!==invoxmd.wsMessage.AUDIO_SOURCE_GET_LEVEL){var r;r=n===invoxmd.wsMessage.RECOGNIZER_SET_VISIBLE_TEXT?s.substring(0,10)+" ... "+s.slice(-10)+" [length: "+(s.length-2)+"]":s.replace(/"Audio":"[^"]*"/g,'"Audio":"..."'),window.console.log("[debug]: SEND: "+n+"-"+i+" "+r)}e.CallsTable[i]=function(e,n){n.State=e.State,n.Error=e.ExceptionType,t&&t(e,n)},e.InvoxMD_Support&&e.InvoxMD_Support.wsSend?(s=encodeURIComponent(s),e.InvoxMD_Support.wsSend(n+"-"+i+" "+s)):e.Socket&&e.Socket.readyState==e.Socket.OPEN&&e.Socket.send(n+"-"+i+" "+s)},o.sendMessageAsync=function(e,n,o){var t=null==o?"False":this.stringify(o);e.InvoxMD_Support&&e.InvoxMD_Support.wsSend?(t=encodeURIComponent(t),e.InvoxMD_Support.wsSend(n+" "+t)):e.Socket&&e.Socket.readyState==e.Socket.OPEN&&e.Socket.send(n+" "+t)},o.base64Encode=function(e){for(var n=new Uint8Array(e),o=n.byteLength,t="",i=0;i<o;i++)t+=String.fromCharCode(n[i]);return window.btoa(t)},o.createCookie=function(e,n,o){var t;if(o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3),t="; expires="+i.toGMTString()}else t="";o<0?window.console.log("[debug]: Removing cookie: "+e):window.console.log("[debug]: Creating cookie: "+e+"="+n),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(n)+t+"; path=/"},o.removeCookie=function(e){invoxmd.util.createCookie(e,"",-1)},o.readCookie=function(e){for(var n=e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),o=new RegExp("^\\s*"+n+"=(.*)$"),t=document.cookie.split(";"),i=0;i<t.length;i++){var s=t[i],r=o.exec(s);if(r)return value=decodeURIComponent(r[1]),"undefined"===value&&(value=null),window.console.log("[debug]: Returning existing cookie: "+e+"="+value),value}return window.console.log("[debug]: Returning null for cookie: "+e),null},o.adaptTextFromSelect=function(e,n){return invoxmd.Formatter.adaptTextFromTextSelected(e,n)},o.adaptText=function(e,n,o,t){return invoxmd.Formatter.adaptText(e,new invoxmd.Range(n,o),t,invoxmd.Formatter.NORMAL_CASE)},o.acceptDictation=function(e,n){var o=void 0==n.attr("imdseltag"),t=void 0==n.get(0).selectionStart,i=n.prop("value"),s=void 0,r=void 0;if(n.focus(),t&&(s=n.attr("imdselstart"),r=n.attr("imdselend"),void 0!==s&&void 0!==r&&n.setSelection(s,r)),void 0==s||void 0==r){var a=n.getSelection();s=a.start,r=a.end}n.replaceSelectedText(invoxmd.util.adaptText(i,s,r,e.Hypothesis.Text)),t&&n.trigger("change.imd"),o&&(t&&n.on("change.imd click.imd contextmenu.imd dblclick.imd keyup.imd",function(e){var n=jQuery(e.target),o=n.getSelection();n.attr("imdselstart",o.start),n.attr("imdselend",o.end)}),n.blur(function(e){var n=jQuery(e.target);n.collapseSelection(!0);var o=n.attr("imdselstart");void 0!==o&&n.attr("imdselend",o)}),n.attr("imdseltag","true"))},o.FormatText=function(e,n,o,t,i,s,r){var a={Text:n,LeftContext:o,RightContext:t,FormatCase:i,Words:s};invoxmd.util.sendMessage(e,invoxmd.wsMessage.FORMAT_TEXT,a,r)},o.getBrowserName=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,n="undefined"!=typeof InstallTrigger,o=/constructor/i.test(window.HTMLElement)||function(e){return"[object SafariRemoteNotification]"===e.toString()}(!window["safari"]||"undefined"!=typeof safari&&safari.pushNotification),t=!!document.documentMode,i=!t&&!!window.StyleMedia,s=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),r=s&&-1!=navigator.userAgent.indexOf("Edg"),a=((s||e)&&window.CSS,invoxmd.BrowserName.UNKNOWN);return e&&(a=invoxmd.BrowserName.OPERA),n&&(a=invoxmd.BrowserName.FIREFOX),o&&(a=invoxmd.BrowserName.SAFARI),t&&(a=invoxmd.BrowserName.IE),i&&(a=invoxmd.BrowserName.EDGE),s&&(a=invoxmd.BrowserName.CHROME),r&&(a=invoxmd.BrowserName.EDGE_CHROME),a},o.IsWebSocketAvailable=function(){return"WebSocket"in window||"MozWebSocket"in window},o.IsAudioContextAvailable=function(){return"AudioContext"in window||"webkitAudioContext"in window},e.ForceFlash=!1,e.TryFlashIfHTML5Fail=!0,o.IsFlashRequired=function(n){var t=o.IsWebSocketAvailable(),i=!n&&!o.IsAudioContextAvailable();return e.ForceFlash||!t||i},o.SWFdomId="invox-flash-component",o.GetFlashObject=function(){return document.getElementById(o.SWFdomId)||null};var t=function(){if(!o.GetFlashObject()){var e=document.createElement("div");e.innerHTML='<a href="https://get.adobe.com/es/flashplayer/">Active los permisos de Flash</a>',e.id=o.SWFdomId,document.body.appendChild(e)}},i=document.getElementsByTagName("script"),s=i[i.length-1],r=s.src.substring(0,s.src.lastIndexOf("/"))+"/",a=function(e){return"function"!=typeof e&&(e=function(e){window.console.log("[log] Flash loaded "+(e&&e.success?"successfully":"incorrectly"))}),function(){swfobject.embedSWF(r+"InvoxMD_Support.swf",invoxmd.util.SWFdomId,401,301,"10.0.0",null,null,{menu:"false",wmode:"transparent",allowscriptaccess:"always"},null,e)}};o.LoadFlashComponent=function(e){invoxmd.log("Cargando el componente Flash."),t();var n=a(e);if("undefined"!=typeof swfobject)n();else{var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src=r+"swfobject.js",i.onload=i.onreadystatechange=n,o.appendChild(i)}},o.LoadOpusComponent=function(){invoxmd.log("Cargando librerías necesarios para el envío de audio OPUS.");var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=r+"opus-recorder.min.js",n.onload=n.onreadystatechange=onInvoxLoaded,e.appendChild(n)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o={};e.DTOs=o,o.RemoteDeviceResponse=function(e){return{MicName:e}}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n,o,r,d){s=this,arguments.length>5&&(d=arguments[5]),this.InvoxMD_Support=invoxmd.util.GetFlashObject(),this.User=null,this.DefaultVolume=i,this.SessionKey=r?a():null,this.SessionVolume=null,this.State=invoxmd.sessionState.DISCONNECTED,this.Error=invoxmd.exceptionType.NONE,this.UseAgent=d,this.UseOnlyButtons=!1,this.Trainer=new invoxmd.Trainer(this),this.RecognizerEngine=new invoxmd.RecognizerEngine(this),this.Recognizer=new invoxmd.Recognizer(this),this.Macros=new invoxmd.MacroRepository(this),this.Dictionary=new invoxmd.Dictionary(this),this.UserITNs=new invoxmd.UserITNs(this),this.MicSettingsRepository=new invoxmd.MicSettingsRepository(this),this.SessionActEventHandler=null,this.ActionHandlerTable={},this.Socket=null,this.Host=e,this.Port=n,this.Secure=o||!this.UseAgent,this.UseAgent&&(this.Host=this.Secure?"localhost":"127.0.0.1"),this.Persistent=r,this.CallsTable={},this.IntervalId=null;var c=function(e){e.match(new RegExp("^"+invoxmd.wsMessage.AUDIO_SOURCE_GET_LEVEL,"g"))||window.console.log("[debug]: RECEIVE: "+e.replace(/"Audio":"[^"]*"/g,'"Audio":"..."'))},u=function(e){if(!t){var n=new Array;for(var o in invoxmd.wsMessage)invoxmd.wsMessage.hasOwnProperty(o)&&n.push(invoxmd.wsMessage[o]);t=new RegExp("("+n.join("|")+")(?:-(\\d+))?\\s+(.+)","i")}var i=t.exec(e);return{Action:i[1],Id:i[2],Payload:JSON.parse(i[3])}};this.onopen=function(e){var n=e.currentTarget&&e.currentTarget.session?e.currentTarget.session:this;window.console.log("[log]: Websocket opened"),n.SessionActEventHandler&&(n.State=invoxmd.sessionState.CONNECTING,n.SessionActEventHandler({Act:invoxmd.sessionAct.NET_CONNECTION_OK}))},this.onclose=function(e){var n=e.currentTarget&&e.currentTarget.session?e.currentTarget.session:this;window.console.log("[log]: Websocket closed: "+JSON.stringify(e)),n._stopKeepAliveInterval();var o=invoxmd.sessionAct.WEBSOCKET_CLOSED;n.isDisconnected()||(n.State=invoxmd.sessionState.DISCONNECTED,n.Error=invoxmd.exceptionType.CONNECTION,n._postClose(),o=invoxmd.sessionAct.NET_CONNECTION_LOST),n.SessionActEventHandler&&n.SessionActEventHandler({Act:o})},this.onerror=function(e){var n=e.currentTarget&&e.currentTarget.session?e.currentTarget.session:this;window.console.log("[log]: Websocket error: "+JSON.stringify(e)),!n.InvoxMD_Support&&invoxmd.TryFlashIfHTML5Fail&&(invoxmd.log("No se ha podido usar Websockets Nativos, se intentará con Flash."),window.console.log("[log] Trying to use flash socket"),invoxmd.util.LoadFlashComponent())},this.onmessage=function(e){var n=e.currentTarget&&e.currentTarget.session?e.currentTarget.session:this,o=n.Socket?e.data:decodeURIComponent(e.message);c(o);var t=u(o),i=t.Action,s=t.Id,r=t.Payload;switch(i){case invoxmd.wsMessage.COMMAND_EVENT:var a=r.Hypothesis.GrammarId,d=n.RecognizerEngine.CommandGrammars[a];d?d.CommandEventHandler&&d.CommandEventHandler(r):n.Recognizer.CommandEventHandler&&n.Recognizer.CommandEventHandler(r);break;case invoxmd.wsMessage.CURRENT_SCOPE_EVENT:n.Recognizer.CurrentScopeEventHandler&&n.Recognizer.CurrentScopeEventHandler(r),n.Recognizer.CurrentScope=r.CurrentScope;break;case invoxmd.wsMessage.DICTATION_EVENT:var a=r.Hypothesis.GrammarId,E=n.RecognizerEngine.LangModels[a];E?E.DictationEventHandler&&E.DictationEventHandler(r):n.Recognizer.DictationEventHandler&&n.Recognizer.DictationEventHandler(r);break;case invoxmd.wsMessage.END_CORRECTION_EVENT:n.Recognizer.EndCorrectionEventHandler&&n.Recognizer.EndCorrectionEventHandler(r);break;case invoxmd.wsMessage.KEYBOARD_EVENT:n.Recognizer.KeyboardEventHandler&&n.Recognizer.KeyboardEventHandler(r);break;case invoxmd.wsMessage.NEW_CORRECTION_EVENT:n.Recognizer.NewCorrectionEventHandler&&n.Recognizer.NewCorrectionEventHandler(r);break;case invoxmd.wsMessage.PHONETIC_EVENT:n.Recognizer.PhoneticEventHandler&&n.Recognizer.PhoneticEventHandler(r);break;case invoxmd.wsMessage.MICCONFIG_REQUIRED_EVENT:n.Recognizer.MicConfigEventHandler&&n.Recognizer.MicConfigEventHandler(r);break;case invoxmd.wsMessage.TRAINING_REQUIRED_EVENT:n.Recognizer.TrainingEventHandler&&n.Recognizer.TrainingEventHandler(r);break;case invoxmd.wsMessage.SESSION_ACT_EVENT:n.SessionActEventHandler&&n.SessionActEventHandler(r),r.Act==invoxmd.sessionAct.NET_CONNECTION_DUP&&(n.State=invoxmd.sessionState.DISCONNECTED,n._postClose());break;case invoxmd.wsMessage.TRAINING_SENTENCE_EVENT:n.Trainer.TrainingSentenceEventHandler&&n.Trainer.TrainingSentenceEventHandler(r);break;case invoxmd.wsMessage.CONTROL_DEVICE_EVENT:var m=n.getAudioSource();m&&m.ControlDeviceEventHandler&&m.ControlDeviceEventHandler(r);break;default:n.CallsTable[s]&&(n.CallsTable[s](r,n),n.CallsTable[s]=null),n.ActionHandlerTable[i]&&n.ActionHandlerTable[i](r,n)}}}var t=null,i=.1,s=null;e.Session=o,e.GetCurrentSession=function(){return s};var r=function(e){return(new Date).getTime()-e.LastTimeStampKeepAlive<=6e5},a=function(){var e=null;if(null==(e=invoxmd.util.readCookie("_imd_info")))return null;try{var n=JSON.parse(e);return r(n)?n.SessionKey:null}catch(e){return null}};o.prototype._addOrUpdatePesistentReconnectInfo=function(){if(this.Persistent){invoxmd.util.removeCookie("_imd_info");var e={SessionKey:this.SessionKey,LastTimeStampKeepAlive:(new Date).getTime()};invoxmd.util.createCookie("_imd_info",JSON.stringify(e))}},o.prototype._removePersistentReconnectInfo=function(){this.SessionKey=null,this.Persistent&&invoxmd.util.removeCookie("_imd_info")},o.prototype._startKeepAliveInterval=function(){invoxmd.log("Iniciando envío de Keep Alive.");var e=this;this._stopKeepAliveInterval(),this.IntervalId=setInterval(function(){e.SessionKey&&invoxmd.util.sendMessage(e,invoxmd.wsMessage.KEEP_ALIVE,null,function(n,o){n.ExceptionType==invoxmd.exceptionType.NONE?e._addOrUpdatePesistentReconnectInfo():n.ExceptionType==invoxmd.exceptionType.INVALID_SESSION?e._removePersistentReconnectInfo():e._stopKeepAliveInterval()})},2e4)},o.prototype._stopKeepAliveInterval=function(){this.IntervalId&&(invoxmd.log("Deteniendo envío de Keep Alive."),clearInterval(this.IntervalId),this.IntervalId=0)},o.prototype._postOpen=function(){if(this.Error===invoxmd.exceptionType.NONE){this._addOrUpdatePesistentReconnectInfo(),this._startKeepAliveInterval();var e=null,n=null;switch(this.State){case invoxmd.sessionState.RECOGNIZER_ENGINE_PAUSED:case invoxmd.sessionState.RECOGNIZER_ENGINE_RUNNING:e=this.RecognizerEngine.AudioSource,n=this.RecognizerEngine;break;case invoxmd.sessionState.TRAINER_PAUSED:case invoxmd.sessionState.TRAINER_RUNNING:e=this.Trainer.AudioSource,n=this.Trainer;break;case invoxmd.sessionState.RECOGNIZING:e=this.Recognizer.AudioSource,n=this.Recognizer}e?e.start():n&&n.stop()}},o.prototype._postClose=function(){var e=this.getAudioSource();e&&e.stop()},o.prototype.getAudioSource=function(){return this.RecognizerEngine.AudioSource||this.Trainer.AudioSource||this.Recognizer.AudioSource||this.AudioSource},o.prototype.connect=function(){var e=" contra el servicio de "+(this.UseAgent?invoxmd.PRODUCTNAME+" Agent":"dictado en "+this.Host+":"+this.Port)+".";if(this.InvoxMD_Support)invoxmd.log("Creando conexión con Flash Socket"+e),this.InvoxMD_Support.registerWSCallbackOpen("invoxmd.GetCurrentSession().onopen"),this.InvoxMD_Support.registerWSCallbackMessage("invoxmd.GetCurrentSession().onmessage"),this.InvoxMD_Support.registerWSCallbackClose("invoxmd.GetCurrentSession().onclose"),this.InvoxMD_Support.registerWSCallbackClose("invoxmd.GetCurrentSession().onerror"),this.InvoxMD_Support.wsClose(),this.InvoxMD_Support.wsConnect(this.Host,this.Port,this.Secure,this.SessionKey?"_imd_key="+this.SessionKey:null);else{var n="WebSocket"in window?"WebSocket":"MozWebSocket"in window?"MozWebSocket":null;if(null===n)return void window.console.log("[error] Native WebSocket not available.");invoxmd.log("Creando conexión con Native Socket"+e),this.Socket=new window[n]((this.Secure?"wss":"ws")+"://"+this.Host+":"+this.Port),this.Socket.callsTable=this.CallsTable,this.Socket.session=this,this.Socket.onopen=this.onopen,this.Socket.onmessage=this.onmessage,this.Socket.onclose=this.onclose,this.Socket.onerror=this.onerror}},o.prototype.close=function(){invoxmd.log("Cerrando Socket activo."),this._stopKeepAliveInterval(),null!==this.Socket&&this.Socket.close()},o.prototype._setLoginInfoResult=function(e){this.User=e.User,this.SessionKey=e.SessionKey,this.SWSVersion=e.SWSVersion,this.AgentVersion=e.AgentVersion},o.prototype.restoreSession=function(e){var n=this;window.console.log("[debug] Intentando recuperar la sesión para el usuario: "+e.Login);var o=function(){invoxmd.log("No se ha podido recuperar sesión, se realizará un inicio de sesión completo."),n._removePersistentReconnectInfo(),n.login(e.Login,e.Password)},t=setTimeout(function(){window.console.log("[warn] El método "+invoxmd.wsMessage.RESTORE_SESSION+" está tardando mucho en responder. Se descarta restauración de sesión."),o()},5e3),i={SessionKey:this.SessionKey,User:e.Login};invoxmd.log("Intentando recuperar la sesión activa"),invoxmd.util.sendMessage(n,invoxmd.wsMessage.RESTORE_SESSION,i,function(e,n){clearTimeout(t),n._setLoginInfoResult(e),n._postOpen(),n.Error===invoxmd.exceptionType.NONE?invoxmd.log("Sesión recuperada correctamente para el usuario '"+n.User.Login+"'."):o()})},o.prototype.login=function(e,n){var o={Login:e,Password:n,Remember:!0,Force:!0};if(this.SessionKey)return void this.restoreSession(o);invoxmd.log("Iniciando sesión para el usuario: "+e+"."),invoxmd.util.sendMessage(this,invoxmd.wsMessage.LOGIN,o,function(e,n){n._setLoginInfoResult(e),n.Error==invoxmd.exceptionType.NONE&&n._postOpen()})},o.prototype.logout=function(e){invoxmd.log("Cerrando la sesión activa."),invoxmd.util.removeCookie("_imd_info"),invoxmd.util.sendMessage(this,invoxmd.wsMessage.LOGOUT,null,function(n,o){o.User=null,o._removePersistentReconnectInfo(),"function"==typeof e&&e(n,o)})},o.prototype.updateProfile=function(){invoxmd.util.sendMessage(this,invoxmd.wsMessage.UPDATE_PROFILE,null,function(e,n){})},o.prototype.setVolumeFromDb=function(e){this.MicSettingsRepository.setWebVolumeFromDb(e)},o.prototype.updateVolumeIntoDb=function(e,n){this.MicSettingsRepository.updateWebVolumeIntoDb(e,n)},o.prototype.recordAudioStart=function(e){var n="Start"+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,n,e)},o.prototype.recordAudioStop=function(e){var n="Stop"+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,n,e)},o.prototype.recordAudioGetStatus=function(e){var n="GetStatus"+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,n,e)},o.prototype.recordAudioAddUsers=function(e,n){var o="AddUser"+(e?" "+e:"")+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,o,n)},o.prototype.recordAudioRemoveUsers=function(e,n){var o="RemoveUser"+(e?" "+e:"")+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,o,n)},o.prototype.recordAudioGetUserList=function(e){var n="GetUserList"+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,n,e)},o.prototype.recordAudioSaveReport=function(e,n){"function"==typeof e&&void 0==n&&(n=e,e="");var o="SaveReport"+(e?" "+e.replace(/\s+/g,"_"):"")+(this.AdminToken?" token:"+this.AdminToken:"");invoxmd.util.sendMessage(this,invoxmd.wsMessage.RECORD_AUDIO,o,n)},o.prototype.setAdminToken=function(e){this.AdminToken=e},o.prototype.isDisconnected=function(){return this.State==invoxmd.sessionState.DISCONNECTED}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n,o){if(this.Text=void 0!==e?e:null,null!==n){this.Pronunciations=new Array(n.length);for(var t=0;t<n.length;t++)this.Pronunciations[t]=new invoxmd.Pronunciation(n[t].Symbol,n[t].POS)}else this.Pronunciations=null;this.Shared=void 0!==o?o:null}e.Word=o,o.prototype.toString=function(){return JSON.stringify(this)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.Symbol=e,this.POS=n}e.Pronunciation=o,o.prototype.toString=function(){return JSON.stringify(this)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e}e.Dictionary=o,o.prototype.getWords=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.DICTIONARY_GET_WORDS,null,function(e,n){var o=e.Words;e.Words=new Array(o.length);for(var t=0;t<o.length;t++){var i=o[t];e.Words[t]=new invoxmd.Word(i.Text,i.Pronunciations,i.Shared)}})},o.prototype.addWord=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.DICTIONARY_ADD_WORD,e)},o.prototype.removeWord=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.DICTIONARY_REMOVE_WORD,e)},o.prototype.replaceWord=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.DICTIONARY_REPLACE_WORD,[e,n])}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n,o,t){t==invoxmd.macroType.PAUSE?(e="#P"+n,n+="ms",o=!1):t==invoxmd.macroType.COMPOSITE&&(o=!1),this.Name=void 0!==e?e:null,this.Replacement=void 0!==n?n:null,this.Shared=void 0!==o?o:null,this.Subtype=void 0!==t?t:null}var t=new RegExp("#P(\\d+)");e.Macro=o,o.prototype._buildMacrosDict=function(e){for(var n=new Array(e.length),o=0;o<e.length;o++)n[e[o].Name]=e[o];return n},o.prototype.getSubmacros=function(e,n){if(this.Subtype==invoxmd.macroType.COMPOSITE){var o=this._buildMacrosDict(e),i=this._buildMacrosDict(n),s=new Array;if(this.Replacement)for(var r=this.Replacement.split("|"),a=0;a<r.length;a++){var d=r[a],c=t.exec(d);c&&(c=parseInt(c[1]));var u=c?new invoxmd.Macro(null,c,!1,invoxmd.macroType.PAUSE):o[d]||i[d];u&&s.push(u)}return s}return null},o.prototype.setSubmacros=function(e){if(this.Subtype==invoxmd.macroType.COMPOSITE){for(var n=new Array(e.length),o=0;o<e.length;o++)n[o]=e[o].Name;this.Replacement=n.join("|")}},o.prototype.toString=function(){return JSON.stringify(this)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e}e.MacroRepository=o,o.prototype._doGetMacros=function(e){invoxmd.util.sendMessage(this.Session,e,null,function(e,n){var o=e.Macros;e.Macros=new Array(o.length);for(var t=0;t<o.length;t++){var i=o[t];e.Macros[t]=new invoxmd.Macro(i.Name,i.Replacement,i.Shared,i.Subtype)}})},o.prototype.getMacros=function(){this._doGetMacros(invoxmd.wsMessage.MACROS_GET_MACROS)},o.prototype.getGlobalMacros=function(){this._doGetMacros(invoxmd.wsMessage.MACROS_GET_GLOBAL_MACROS)},o.prototype.addMacro=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.MACROS_ADD_MACRO,e)},o.prototype.removeMacro=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.MACROS_REMOVE_MACRO,e)},o.prototype.replaceMacro=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.MACROS_REPLACE_MACRO,[e,n])}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(){}e.SimpleCommandSpecBuilder=o,o.prototype.buildSequence=function(e){return new invoxmd.SimpleSpecCommandSequence(e)},o.prototype.buildOptionalSequence=function(e){return this.buildOptionalRepetition(this.buildSequence(e))},o.prototype.buildOptions=function(e){return new invoxmd.SimpleSpecCommandOptions(e)},o.prototype.buildOptionalOptions=function(e){return this.buildOptionalRepetition(this.buildOptions(e))},o.prototype.buildText=function(e){return new invoxmd.SimpleSpecCommandText(e)},o.prototype.buildOptionalText=function(e){return this.buildOptionalRepetition(this.buildText(e))},o.prototype.buildRepetition=function(e,n,o){return new invoxmd.SimpleSpecCommandRepeat(e,n,o)},o.prototype.buildOptionalRepetition=function(e){return this.buildRepetition(e,0,1)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Sequence=e,this.Semantica={}}e.SimpleSpecCommandSequence=o,o.prototype.addSemanticInfo=function(e,n){this.Semantica[e]=n}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Options=e,this.Semantica={}}e.SimpleSpecCommandOptions=o,o.prototype.addSemanticInfo=function(e,n){this.Semantica[e]=n}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n,o){this.Element=e,this.Min=n,this.Max=o,this.Semantica={}}e.SimpleSpecCommandRepeat=o,o.prototype.addSemanticInfo=function(e,n){this.Semantica[e]=n}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Text=e,this.Semantica={}}e.SimpleSpecCommandText=o,o.prototype.addSemanticInfo=function(e,n){this.Semantica[e]=n}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.BoolValue=e}e.BoolSemanticInfo=o
}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.IntValue=e}e.IntSemanticInfo=o}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.FloatValue=e}e.FloatSemanticInfo=o}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.StringValue=e}e.StringSemanticInfo=o}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.Id=e,this.CommandSpec=n,this.CommandEventHandler=null}e.CommandGrammar=o}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n,o){this.Id=e,this.Uri=n,this.NumAlternates=o,this.DictationEventHandler=null}e.LanguageModel=o}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){var n=e.split(",");this.Name=n.shift(),this.Value=n}e.MicSetting=o,o.prototype.toArray=function(){var e=this.Value;return e.unshift||(e=[e]),e.unshift(this.Name),e}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e}e.MicSettingsRepository=o;var t=invoxmd.util.getBrowserName();o.prototype.getVolumeSettings=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.MISC_GET_VOLUME_SETTINGS,null,function(n,o){if(o.Error==invoxmd.exceptionType.NONE){var t=(n.Value||"").split("\r\n");n.Value=[];for(var i=0;i<t.length;i++){var s=t[i];""!=s&&n.Value.push(new invoxmd.MicSetting(s))}"function"==typeof e&&e(n,o)}})},o.prototype.setWebVolumeFromDb=function(e){var n=this.getMicName();this.getVolumeSettings(function(o,t){if(t.Error==invoxmd.exceptionType.NONE){var i=o.Value;o.Value="False";for(var s=0;s<i.length&&"False"==o.Value;s++){var r=i[s];r.Name==n&&(o.Value="True",t.SessionVolume=+r.Value.shift())}if("True"==o.Value){var a="Recuperado valor de micrófono: "+n+" : "+t.SessionVolume;invoxmd.log(a)}else{var a="No se ha encontrado el micrófono: "+n;invoxmd.log(a)}"function"==typeof e&&e(o,t)}})},o.prototype.getMicName=function(){var e=this.Session.getAudioSource(),n="WEB - "+t+" - "+e.CodecType;if(e.getDeviceName){n+=" - "+e.getDeviceName()}return n},o.prototype.updateWebVolumeIntoDb=function(e,n){var o=this.getMicName(),t=this;this.getVolumeSettings(function(i,s){if(s.Error==invoxmd.exceptionType.NONE){var r=i.Value,a=[];i.Value=null,i.PreviousWebVolume=null;for(var d=0;d<r.length;d++){var c=r[d];c.Name==o&&(i.PreviousWebVolume=c.Value,c.Value[0]=+e),a.push(c.toArray())}if(null==i.PreviousWebVolume){var u=new invoxmd.MicSetting(o+","+e+","+o);a.push(u.toArray());var E="Añadiendo valor de micrófono: "+o+" : "+e;invoxmd.log(E)}else{var E="Actualizando valor de micrófono: "+o+" : "+e+" anterior: "+i.PreviousWebVolume;invoxmd.log(E)}invoxmd.util.sendMessage(s,invoxmd.wsMessage.MISC_UPDATE_VOLUME_SETTINGS,a,function(e,o){o.Error==invoxmd.exceptionType.NONE&&(t.CheckAudioDevice(),"function"==typeof n&&n(e,o))})}})},o.prototype.SetOrUploadSessionVolume=function(){var e=this.Session;(!e.SessionVolume||e.User&&e.User.ForzarMicConfig)&&this.setWebVolumeFromDb(function(e,n){"True"!=e.Value&&n.SessionVolume>0&&n.MicSettingsRepository.updateWebVolumeIntoDb(n.SessionVolume)})},o.prototype.CheckAudioDevice=function(){var e=this.Session,n=e.getAudioSource(),o=invoxmd.wsMessage.CHECK_REMOTE_DEVICE,t=n.getDeviceName?n.getDeviceName():"NO BROWSER MIC ACCESIBLE",i=invoxmd.DTOs.RemoteDeviceResponse(t);invoxmd.util.sendMessage(e,o,i,function(e,o){e.ExceptionType===invoxmd.exceptionType.NOT_IMPLEMENTED?(n.MicrophoneIsChecked=!1,n.MicrophoneIsValid=void 0,n.MicrophoneIsConfigured=!0):(n.MicrophoneIsChecked=!0,n.MicrophoneIsValid=e.MicrophoneIsValid,n.MicrophoneIsConfigured=e.MicrophoneIsConfigured)})}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.AudioSource=null,this.CommandSpecBuilder=new invoxmd.SimpleCommandSpecBuilder,this.Session=e,this.CommandGrammars=new Array,this.LangModels=new Array,this.History=new invoxmd.RecognizerHistory(e)}e.RecognizerEngine=o,o.prototype.getMaxAlternates=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_GET_MAX_ALTERNATES)},o.prototype.setMaxAlternates=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_SET_MAX_ALTERNATES,e)},o.prototype.start=function(e){this.AudioSource=e,this.CommandGrammars=new Array,this.LangModels=new Array,invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_START)},o.prototype.stop=function(){this.AudioSource&&this.AudioSource.stop(),invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_STOP)},o.prototype.play=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_PLAY,null,function(e,n){n.Error==invoxmd.exceptionType.NONE&&n.RecognizerEngine.AudioSource&&n.RecognizerEngine.AudioSource.start()})},o.prototype.pause=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_PAUSE,null,function(e,n){n.Error==invoxmd.exceptionType.NONE&&n.RecognizerEngine.AudioSource&&n.RecognizerEngine.AudioSource.stop()})},o.prototype.flush=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_FLUSH,e)},o.prototype.setFeedbackSuppression=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_SET_FEEDBACK_SUPPRESSION,e)},o.prototype.addCommandGrammar=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_ADD_COMMAND_GRAMMAR,e,function(n,o){o.Error==invoxmd.exceptionType.NONE&&(o.RecognizerEngine.CommandGrammars[e.Id]=e)})},o.prototype.addLanguageModel=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_ADD_LANGUAGE_MODEL,e,function(n,o){o.Error==invoxmd.exceptionType.NONE&&(o.RecognizerEngine.LangModels[e.Id]=e)})},o.prototype.removeGrammar=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_REMOVE_GRAMMAR,e,function(n,o){o.Error==invoxmd.exceptionType.NONE&&(delete o.RecognizerEngine.CommandGrammars[e],delete o.RecognizerEngine.LangModels[e])})},o.prototype.isGrammarActive=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_IS_GRAMMAR_ACTIVE,e)},o.prototype.activateGrammars=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_ACTIVATE_GRAMMARS,e)},o.prototype.deactivateGrammars=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_DEACTIVATE_GRAMMARS,e)},o.prototype.resetGrammarsState=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_RESET_GRAMMARS_STATE)},o.prototype.getGrammarsState=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_GET_GRAMMARS_STATE)},o.prototype.setGrammarsState=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_SET_GRAMMARS_STATE,e)},o.prototype.getRecognitionDetail=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_GET_RECOGNITION_DETAIL,e)},o.prototype.emulateRecognition=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_ENGINE_EMULATE_RECOGNITION,e)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.CurrentScope=invoxmd.dictationScope.NONE,this.AudioSource=null,this.Session=e,this.CommandEventHandler=null,this.CurrentScopeEventHandler=null,this.DictationEventHandler=null,this.EndCorrectionEventHandler=null,this.InstanceSelectionEventHandler=null,this.KeyboardEventHandler=null,this.NewCorrectionEventHandler=null,this.PhoneticEventHandler=null,this.MicConfigEventHandler=null}e.Recognizer=o,o.prototype.start=function(e){invoxmd.log("Iniciando el Reconocedor de dictado."),this.AudioSource=e,invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_START,null,function(n,o){if(o.Error==invoxmd.exceptionType.NONE&&o.Recognizer.AudioSource){o.Recognizer.AudioSource.start();var t=function(){if(!e||!e.getAccessAllowed())return void setTimeout(t,1e3);o.MicSettingsRepository.CheckAudioDevice();var n=!o.SessionVolume,i=o.User&&o.User.TrainingInfo&&o.User.TrainingInfo.TrainingRequired;n&&"function"==typeof o.Recognizer.MicConfigEventHandler?o.Recognizer.MicConfigEventHandler():i&&"function"==typeof o.Recognizer.TrainingEventHandler&&o.Recognizer.TrainingEventHandler()};t()}})},o.prototype.stop=function(){invoxmd.log("Deteniendo el Reconocedor de dictado."),this.AudioSource&&this.AudioSource.stop(),invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_STOP)},o.prototype.getScope=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_GET_SCOPE)},o.prototype.setScope=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_SET_SCOPE,e)},o.prototype.setFeedbackSuppression=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_SET_FEEDBACK_SUPPRESSION,e)},o.prototype.setVisibleText=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_SET_VISIBLE_TEXT,e)},o.prototype.setBookmarks=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_SET_BOOKMARKS,e)},o.prototype.getRecognitionDetail=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_GET_RECOGNITION_DETAIL,e)},o.prototype.emulateRecognition=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_EMULATE_RECOGNITION,e)},o.prototype.emulateCommand=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_EMULATE_COMMAND,[e,n])},o.prototype.learnNewWords=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_LEARN_NEW_WORDS,e)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.Pattern=e,this.Substitution=n}e.UserITN=o,o.prototype.toString=function(){return JSON.stringify(this)},o.prototype.compareTo=function(e){return this.Pattern.localeCompare(e.Pattern,"kn",{numeric:!0})||this.Substitution.localeCompare(e.Substitution,"kn",{numeric:!0})},o.prototype.equals=function(e){return 0==this.compareTo(e)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e}e.UserITNs=o,o.prototype.getUserITNs=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.USERITNS_GETUSERITNS,null,function(n,o){var t=n.ITNs;n.ITNs=new Array(t.length);for(var i=0;i<t.length;i++){var s=t[i];n.ITNs[i]=new invoxmd.UserITN(s.CleanPattern||s.Pattern,s.Substitution)}n.ITNs.sort(function(e,n){return e.compareTo(n)}),"function"==typeof e&&e(n,this.Session)})},o.prototype.addITN=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.USERITNS_ADDUSERITN,e,n)},o.prototype.removeITN=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.USERITNS_REMOVEUSERITN,e,n)},o.prototype.replaceITN=function(e,n,o){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.USERITNS_REPLACEUSERITN,[e,n],o)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e,this.AudioSource=null,this.TrainingSentenceEventHandler=null}e.Trainer=o,o.prototype.start=function(e){this.AudioSource=e,invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_START,!0,function(e,n){e.ExceptionType===invoxmd.exceptionType.NONE&&n.Trainer.setMicrophoneName()})},o.prototype.stop=function(){this.AudioSource&&this.AudioSource.stop(),invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_STOP,!0)},o.prototype.play=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_PLAY,null,function(e,n){n.Error==invoxmd.exceptionType.NONE&&n.Trainer.AudioSource&&n.Trainer.AudioSource.start()})},o.prototype.pause=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_PAUSE,null,function(n,o){o.Error==invoxmd.exceptionType.NONE&&o.Trainer.AudioSource&&o.Trainer.AudioSource.stop(),"function"==typeof e&&e(n,o)})},o.prototype.resume=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_RESUME,null,function(n,o){o.Error==invoxmd.exceptionType.NONE&&o.Trainer.AudioSource&&o.Trainer.AudioSource.start(),"function"==typeof e&&e(n,o)})},o.prototype.setTrainingSentences=function(e,n){if(e instanceof Array)invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_SET_TRAINING_SENTENCES,e);else{var o=this;e||(e="frasesEntrenamiento.xml"),n||(n="Frase"),jQuery.get(e,function(e){array=jQuery(e).find(n).map(function(){return jQuery(this).text()}).toArray(),window.console.log("[log]: Loaded "+array.length+" sentences"),invoxmd.util.sendMessage(o.Session,invoxmd.wsMessage.TRAINER_SET_TRAINING_SENTENCES,array)})}},o.prototype.setMicrophoneName=function(e){e||(e=this.Session.MicSettingsRepository.getMicName()),invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_SET_MICROPHONE_NAME,e)},o.prototype.trainAlternate=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.TRAINER_TRAIN_ALTERNATE,e,n)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e,this.LastLevel=0,this.PERIOD_SEND_AUDIO_SOURCE_GET_LEVEL=150}e.VUMeter=o,o.prototype.start=function(){var e=this,n=function(){invoxmd.util.sendMessage(e.Session,invoxmd.wsMessage.AUDIO_SOURCE_GET_LEVEL,null,function(n){n.ExceptionType===invoxmd.exceptionType.NONE&&(e.LastLevel=100*n.Value)})};null!==this.GetLevelIntervalId&&clearInterval(this.GetLevelIntervalId),this.GetLevelIntervalId=setInterval(n,this.PERIOD_SEND_AUDIO_SOURCE_GET_LEVEL)},o.prototype.stop=function(){null!==this.GetLevelIntervalId&&clearInterval(this.GetLevelIntervalId)},o.prototype.getLevel=function(){return this.LastLevel}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.CodecType="Speex",this.Timer=null,this.Recorder=n,this.Session=e,this.FrameSize=this.Recorder.getFrameSize(),this.ControlDeviceEventHandler=null,this.Status=invoxmd.audioStatus.NONE,this.VUMeter=new invoxmd.VUMeter(e),this.PERIOD_SEND_AUDIO_ARRAY_SPEEX=100}e.AudioSource=o,o.prototype.ondenied=null,o.prototype.ongranted=null,o.prototype.start=function(){var e=this;window.console.log("[log]: Starting audio recorder...");var n=!1;this.AllowAccessInterval=setInterval(function(){e.getAccessAllowed()!=n&&(n=!n,n&&"function"==typeof e.ongranted&&e.ongranted(),n||"function"!=typeof e.ondenied||e.ondenied())},1e3);var o=this.Recorder.startRecorder();if(this.Session.MicSettingsRepository.SetOrUploadSessionVolume(),0==o){window.console.log("[log]: Audio recorder started"),this.Status=invoxmd.audioStatus.STARTED,this.VUMeter.start(),this.Read=function(){var e=this.Recorder;return e.read?e.read():null};var t=function(){for(var n=new Array,o=0,t=null;o<1e3&&null!=(t=e.Read());o++)n[o]=invoxmd.util.base64Encode(t);var i=null;return n.length>1&&(i={Data:n,CodecType:e.CodecType}),i},i=function(){var n=t();n&&invoxmd.util.sendMessageAsync(e.Session,invoxmd.wsMessage.SEND_AUDIO_ARRAY,n)};this.Timer=setInterval(i,this.PERIOD_SEND_AUDIO_ARRAY_SPEEX)}else-1==o?(this.Status=invoxmd.audioStatus.NOT_ACCESS,window.console.log("[error]: Could not start audio recorder. No accessible microphone")):(this.Status=invoxmd.audioStatus.STARTED,window.console.log("[warn]: The audio is already initialized"))},o.prototype.stop=function(){this.AllowAccessInterval&&clearInterval(this.AllowAccessInterval),this.Recorder.stopRecorder(),this.Status=invoxmd.audioStatus.STOPPED,this.VUMeter.stop(),this.Timer&&clearInterval(this.Timer)},o.prototype.getVolume=function(){return this.Recorder.getVolume()/100},o.prototype.getOptimumVolume=function(){return this.Recorder.getOptimumVolume()/100},o.prototype.getLevel=function(){return this.VUMeter.getLevel()},o.prototype.getTest=function(){return this.Recorder.getTest()},o.prototype.getAccessAllowed=function(){return this.Recorder.getAccessAllowed()};o.prototype.setVolume=function(e){e=e||.01,e<.01&&(e=.01),this.Recorder.setVolume(100*e)},o.prototype.setTest=function(e){this.Recorder.setTest(e)},o.prototype.setMaxLevel=function(e){this.Recorder.setMaxLevel(e)},o.prototype.setMinLevel=function(e){this.Recorder.setMinLevel(e)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.Session=e,this.ControlDeviceEventHandler=null,this.Status=invoxmd.audioStatus.NONE,this.VUMeter=new invoxmd.VUMeter(e),this.GetLevelIntervalId=null}e.AgentAudioSource=o,o.prototype.ondenied=null,o.prototype.ongranted=null,o.prototype.start=function(){this.Status=invoxmd.audioStatus.STARTED,this.Session.SessionVolume=1,this.VUMeter.start(),"function"==typeof this.ongranted&&this.ongranted()},o.prototype.stop=function(){this.Status=invoxmd.audioStatus.STOPPED,this.VUMeter.stop(),null!==this.GetLevelIntervalId&&clearInterval(this.GetLevelIntervalId),this.LastLevel=0,"function"==typeof this.ondenied&&this.ondenied()},o.prototype.getVolume=function(){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.AUDIO_SOURCE_GET_VOLUME)},o.prototype.getLevel=function(){return this.VUMeter.getLevel()},o.prototype.setVolume=function(e){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.AUDIO_SOURCE_SET_VOLUME,e)},o.prototype.getAccessAllowed=function(){return this.Status==invoxmd.audioStatus.STARTED}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.CodecType="Opus",this.Timer=null,this.Recorder=new invoxmd.InvoxRecorder,this.Session=e,this.FrameSize=this.Recorder.getFrameSize(),this.ControlDeviceEventHandler=null,this.Status=invoxmd.audioStatus.NONE,this.VUMeter=new invoxmd.VUMeter(e),this.PERIOD_SEND_AUDIO_ARRAY_OPUS=100,i=this}function t(){var e=this;this._buffer=[],this.allowed=s.ACCESS_UNKNOWN,this._worker=d+"encoderWorker.min.vocali.js",this._blobs=[],this.ondataavailable=function(n){if(n.length){var o=new Int8Array(n.length);o.set(n,0),e._buffer.push(o)}}}e.OpusAudioSource=o;var i=null;o.prototype.ondenied=null,o.prototype.ongranted=null,o.prototype.start=function(){var e=this;window.console.log("[log]: Starting audio recorder..."),this.Recorder.startRecorder(),window.console.log("[log]: Audio recorder started"),this.Status=invoxmd.audioStatus.STARTED,this.VUMeter.start(),this.Read=function(){var e=this.Recorder;return e.context&&"running"!==e.context.state&&(e.context.resume(),e.context.state="running"),e._recorder&&"recording"!==e._recorder.state&&(e._recorder.start(),e._recorder.state="recording"),e._buffer.shift()||null};var n=function(){for(var n=new Array,o=0,t=null;o<1e3&&null!=(t=e.Read());o++)n[o]=invoxmd.util.base64Encode(t);var i=null;return n.length>1&&(i={Data:n,CodecType:e.CodecType}),i},o=function(){var o=n();o&&invoxmd.util.sendMessageAsync(e.Session,invoxmd.wsMessage.SEND_AUDIO_ARRAY,o)};this.Timer=setInterval(o,this.PERIOD_SEND_AUDIO_ARRAY_OPUS)},o.prototype.stop=function(){this.Recorder.stopRecorder(),this.Status=invoxmd.audioStatus.STOPPED,this.VUMeter.stop(),this.Timer&&clearInterval(this.Timer)},o.prototype.getVolume=function(){return this.Recorder._gain},o.prototype.getLevel=function(){return this.VUMeter.getLevel()};var s={ACCESS_ALLOWED:1,ACCESS_UNKNOWN:-1,ACCESS_NOT_ALLOWED:0};o.prototype.getAccessAllowed=function(){return this.Recorder.allowed==s.ACCESS_ALLOWED};o.prototype.setVolume=function(e){e=e||.4,e>1&&(e/=100),e<.01&&(e=.01);var n=this.Recorder;n._recorder&&(n._gain=e,n._recorder.setRecordingGain(e))},o.prototype.getDeviceName=function(){var e=this.Recorder.getDeviceName();return function(e){var n=e,o=/ \(\w{4}:\w{4}\)$/;n=n.replace(o,"");var t=/.+?\((.+?)\)[^\(]*/,i=t.exec(n);i||(t=/[^-]+- (.+)/,i=t.exec(n)),i&&(n=i[1]);var s=/^\d+- /,r=/ \(\d+\)$/;return n.replace(s,"").replace(r,"")}(e)},e.InvoxRecorder=t;var r=document.getElementsByTagName("script"),a=r[r.length-1],d=a.src.substring(0,a.src.lastIndexOf("/"))+"/";t.prototype.getDeviceName=function(){var e="";if(this.Devices&&this.DeviceId){var n=this.DeviceId,o=this.Devices.find(function(e){return e.deviceId===n});o&&(e=o.label||"")}else console.log("The microphone must be started and allowed before calling the method 'getDeviceName', return empty");return e},t.prototype.getFrameSize=function(){return 10};var c=function(e,o,t){var i=n.navigator.permissions;if(!i)return void e();var s=function(n){"granted"===n&&"function"==typeof e?e():"prompt"===n&&"function"==typeof t?t():"denied"===n&&"function"==typeof e&&o()};i.query({name:"microphone"}).then(function(e){s(e.state),e.onchange=function(){s(this.state)}})["catch"](e)};t.prototype.startRecorder=function(){var e=this;if(this.started)return void console.log("[recorder] Already started");var o=function(n){e.allowed=s.ACCESS_NOT_ALLOWED,e.stopRecorder(),"function"==typeof i.ondenied&&i.ondenied()};return c(function(){n.navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1},video:!1}).then(function(n){var o=window.AudioContext||window.webkitAudioContext;e.context=new o,e.DeviceId=n.getTracks()[0].getSettings().deviceId,e.stream=n,navigator.mediaDevices.enumerateDevices().then(function(n){e.Devices=n,invoxmd.GetCurrentSession().MicSettingsRepository.SetOrUploadSessionVolume(),e.allowed=s.ACCESS_ALLOWED,"function"==typeof i.ongranted&&i.ongranted()});var t={streamPages:!0,encoderSampleRate:16e3,encoderBitRate:65536,originalSampleRateOverride:16e3,maxBuffersPerPage:10,encoderFrameSize:e.getFrameSize(),encoderPath:e._worker};e._recorder=new Recorder(t),e._recorder.ondataavailable=e.ondataavailable,e.started=!0;var r=e.context.createMediaStreamSource(e.stream);e._recorder.start(r)})["catch"](o)},o),0},t.prototype.stopRecorder=function(){this.started&&(console.log("recorder STOP"),this.started=!1,this._recorder.stop(),this.stream.getTracks()[0].stop())}}(void 0===invoxmd?module.exports:invoxmd,this),function(e,n){e.audioSource={},e.audioSource.CreateAudioSource=function(e){var n;return n=e.UseAgent?new invoxmd.AgentAudioSource(e):e.InvoxMD_Support?new invoxmd.AudioSource(e,e.InvoxMD_Support):new invoxmd.OpusAudioSource(e),e.AudioSource=n,n}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.Session=e}e.RecognizerHistory=o,o.prototype.getChunkedAudio=function(e,n){invoxmd.util.sendMessage(this.Session,invoxmd.wsMessage.RECOGNIZER_HISTORY_GET_CHUNKED_AUDIO,e,function(e,o){o.Error==invoxmd.exceptionType.NONE&&n&&n(e.Value.Chunks)})}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e,n){this.start=e,this.end=void 0===n?e:n}e.Range=o,o.prototype.collapsed=function(){return this.start==this.end},o.prototype.collapseStart=function(){return this.end=this.start,this},o.prototype.collapseEnd=function(){return this.start=this.end,this},o.prototype.offset=function(e){return this.offsetStart(e),this.offsetEnd(e),this},o.prototype.offsetStart=function(e){return this.start+=e,this},o.prototype.offsetEnd=function(e){return this.end+=e,this},o.prototype.expandStart=function(e,n,o){var t=null,i=null;for(e=e.substr(0,this.start);null!==(t=n.exec(e));)i=t;return this.start=null!=i?i.index+(o?0:i[0].length):0,this},o.prototype.expandEnd=function(e,n,o){var t=null;e=e.substr(this.end);var t=n.exec(e);return this.end+=null!=t?t.index+(o?t[0].length:0):e.length,n.lastIndex=0,this},o.prototype.clone=function(){return new o(this.start,this.end)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){this.textArea=jQuery(e)}e.TextAreaTextHelper=o,o.prototype.getText=function(e){if(this.textArea.focus(),e.start<e.end){var n=this.getAllText();return n.substr(Math.max(0,e.start),Math.min(e.end,n.length))}return""},o.prototype.getAllText=function(){return this.textArea.focus(),this.textArea.val()},o.prototype.replaceText=function(e){this.textArea.focus(),this.textArea.val(this.textArea.val().substring(0,this.textArea[0].selectionStart)+e+this.textArea.val().substring(this.textArea[0].selectionEnd))},o.prototype.setSelectionRange=function(e){this.textArea.focus();var n=this.getAllText();this.textArea[0].selectionStart=Math.max(0,e.start),this.textArea[0].selectionEnd=Math.min(e.end,n.length)},o.prototype.getSelectionRange=function(){return this.textArea.focus(),new invoxmd.Range(this.textArea[0].selectionStart,this.textArea[0].selectionEnd)}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){var o=e.commands={};o[invoxmd.commandId.NONE]=function(e){},o[invoxmd.commandId.ACCEPT_TEXT]=function(e){},o[invoxmd.commandId.ACTIVATE_SPELLING]=function(e){},o[invoxmd.commandId.ALL_CAPS]=function(e){},o[invoxmd.commandId.CANCEL_TEMPLATE]=function(e){},o[invoxmd.commandId.CANCEL_TEXT]=function(e){},o[invoxmd.commandId.CAPS]=function(e){},o[invoxmd.commandId.CAPS_ACTIVATE]=function(e){},o[invoxmd.commandId.CAPS_DEACTIVATE]=function(e){},o[invoxmd.commandId.CLOSE]=function(e){},o[invoxmd.commandId.CORRECT]=function(e){},o[invoxmd.commandId.CORRECT_SELECTION]=function(e){},o[invoxmd.commandId.DEACTIVATE_SPELLING]=function(e){},o[invoxmd.commandId.DELETE]=function(e){},o[invoxmd.commandId.DELETE_NEXT_PARAGRAPH]=function(e){},o[invoxmd.commandId.DELETE_NEXT_SENTENCE]=function(e){},o[invoxmd.commandId.DELETE_PREV_PARAGRAPH]=function(e){},o[invoxmd.commandId.DELETE_PREV_SENTENCE]=function(e){},o[invoxmd.commandId.DELETE_SELECTION]=function(e){},o[invoxmd.commandId.DELETE_WORDS]=function(e){},o[invoxmd.commandId.GO_TO]=function(e){},o[invoxmd.commandId.GO_TO_AFTER]=function(e){},o[invoxmd.commandId.GO_TO_BEGINNING_DOC]=function(e){e.setSelectionRange(new invoxmd.Range(0))},o[invoxmd.commandId.GO_TO_BEGINNING_PARAGRAPH]=function(e){},o[invoxmd.commandId.GO_TO_BEGINNING_SENTENCE]=function(e){},o[invoxmd.commandId.GO_TO_BOOKMARK]=function(e){},o[invoxmd.commandId.GO_TO_END_DOC]=function(e){},o[invoxmd.commandId.GO_TO_END_PARAGRAPH]=function(e){},o[invoxmd.commandId.GO_TO_END_SENTENCE]=function(e){},o[invoxmd.commandId.GO_TO_NEXT_FIELD]=function(e){},o[invoxmd.commandId.GO_TO_NEXT_GROUP]=function(e){},o[invoxmd.commandId.GO_TO_NEXT_PARAGRAPH]=function(e){},o[invoxmd.commandId.GO_TO_NEXT_SENTENCE]=function(e){},o[invoxmd.commandId.GO_TO_PREV_FIELD]=function(e){},o[invoxmd.commandId.GO_TO_PREV_GROUP]=function(e){},o[invoxmd.commandId.GO_TO_PREV_PARAGRAPH]=function(e){},o[invoxmd.commandId.GO_TO_PREV_SENTENCE]=function(e){},o[invoxmd.commandId.INITIAL_CAPS_ACTIVATE]=function(e){},o[invoxmd.commandId.INITIAL_CAPS_DEACTIVATE]=function(e){},o[invoxmd.commandId.MENU]=function(e){},o[invoxmd.commandId.NEW_REPORT]=function(e){},o[invoxmd.commandId.NO_CAPS]=function(e){},o[invoxmd.commandId.REDO]=function(e){},o[invoxmd.commandId.REDO_WORDS]=function(e){},o[invoxmd.commandId.SAVE]=function(e){},o[invoxmd.commandId.SAVE_REPORT]=function(e){},o[invoxmd.commandId.SELECT]=function(e){},o[invoxmd.commandId.SELECT_ALL]=function(e){},o[invoxmd.commandId.SELECT_NEXT_PARAGRAPH]=function(e){},o[invoxmd.commandId.SELECT_NEXT_SENTENCE]=function(e){},o[invoxmd.commandId.SELECT_PREV_PARAGRAPH]=function(e){},o[invoxmd.commandId.SELECT_PREV_SENTENCE]=function(e){},o[invoxmd.commandId.SELECT_TEMPLATE]=function(e){},o[invoxmd.commandId.START_DICTATION]=function(e){},o[invoxmd.commandId.START_REPRODUCTION]=function(e){},o[invoxmd.commandId.STOP_DICTATION]=function(e){},o[invoxmd.commandId.STOP_REPRODUCTION]=function(e){},o[invoxmd.commandId.TABULATION]=function(e){},o[invoxmd.commandId.UNDO]=function(e){},o[invoxmd.commandId.UNSELECT]=function(e){}}(void 0===invoxmd?module.exports:invoxmd),function(e,n){function o(e){return!!e.match(A)}function t(e){return!!e.match(C)}function i(e){return!!e.match(/\s/)}function s(e){return e.replace(/\b[A-zÀ-ÿ]{3,}/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})}function r(e,n){switch(n){case invoxmd.FormatCase.NORMAL_CASE:return e;case invoxmd.FormatCase.UPPER_CASE:return e.toUpperCase();case invoxmd.FormatCase.TITLE_CASE:return s(e);default:return e}}function a(e){return e===s(e)?invoxmd.FormatCase.TITLE_CASE:e===e.toUpperCase()?invoxmd.FormatCase.UPPER_CASE:invoxmd.FormatCase.NORMAL_CASE}function d(e,n){return!!(e+n).match(G)}function c(e,n){var o=new invoxmd.Range(void 0!=n?n:e.length).expandStart(e,M,!0);return e.substring(o.start,o.end)}function u(e,n){var o=n,i=null;do{i=e[--o]}while(void 0!=i&&t(i));return void 0!=i?i:"\n"}function E(e,n){var o=n,i=null;do{i=e[o++]}while(void 0!=i&&t(i));return void 0!=i?i:"\n"}function m(e,n){return'"'!==n?K:e.match(/\"/g).length%2?X:Y}function l(e,n){var o=m(e,n);return o===K?n:o===X?"¿":"?"}function v(e){return!e||!!e.match(H)}function S(e){return e.replace(A,function(e){return e.toUpperCase()})}function p(e){return e.replace(A,function(e){return e.toLowerCase()})}function R(e,n,o,t){if(!t){e=e.replace(V,b).replace(P,U).replace(D,y).replace(w,L)}return n&&(e=" "+e),o&&(e+=" "),e}function T(e,n,o){return o===invoxmd.FormatCase.NONE?n:(n=n.replace(k,function(e){return e.toUpperCase()}),v(e)&&(n=S(n)),n=r(n,o||invoxmd.FormatCase.NORMAL_CASE))}function N(e,n,o,t){if(!o)return"";var i=u(e,n.start),s=E(e,n.end),r=o.charAt(0),a=o.slice(-1),m=c(e,n.start),v=c(m+o),S=d(l(m,i),l(m+r,r)),p=d(l(v,a),l(v+s,s)),N=R(o,S,p,t===invoxmd.FormatCase.NONE);return N=T(m,N,t||invoxmd.FormatCase.NORMAL_CASE)}function _(e,n){var o=a(n),t=n.charAt(0),s=n.slice(-1),d=r(e,o);return d=R(d,i(t),i(s),!0)}var I=e.Formatter={},A=/[a-zñáéíóúü0-9]/i,g=/[^a-zñáéíóúü0-9\u200b\u200c\u200d\u200e\u200f\u202a\u202b\u202c\u202d\u202e\u202f]/i,x=/[\.\,\;\:]/,O=/[\.\!\?\n\r\-]/,f=/[\¿\¡\(\{\[\<]/,h=/[\?\!\)\}\]\>]/,C=/[\u200b\u200c\u200d\u200e\u200f\u202a\u202b\u202c\u202d\u202e\u202f]/g,M=new RegExp(x.source.replace(",","")+"|"+O.source,"g"),G=new RegExp("([ºª°²³±​]|"+A.source+"|"+x.source+"|"+h.source+")("+A.source+"|"+f.source+")","gi"),D=new RegExp("(^|"+g.source+"| )-([\\S])","gi"),y="$1- $2",w=/(\d+)\.\ -/g,L="$1.-",P=/(.)\ +\./g,U="$1.",V=/\n\ +/g,b="\n",k=new RegExp(O.source+g.source+"+"+A.source,"gi"),H=new RegExp(O.source+"\\s*("+C.source+"|"+f.source+"|"+h.source+")*$"),F=new RegExp(unescape("%A0")+"|&nbsp;","g"),W=unescape("%20"),z=function(e){return e.replace(C,"")},Z=function(e){return e.replace(F,W)},B=function(e){var n=e;return n=z(n),n=Z(n)};I.SENTENCE_DELIM=/\.|\n/g,I.PARRAGRAPH_DELIM=/\n/g;var K=0,X=1,Y=2;I.adaptText=N,I.CleanText=B,I.adaptTextFromTextSelected=_,I.toLowerFirstLetter=p,I.isAlphaNum=o,I.isNonWidthSpace=t,I.isSpaceOrLineSeparator=i,I.toTitleCase=s,I.applyTextCase=r,I.getTextCase=a,I.requireSpace=d,I.getSentenceBeforePosition=c,I.getCharacterBeforePosition=u,I.getCharacterAfterPosition=E,I.quoteType=m,I.normalizeChar=l,I.nextLetterMustBeCapital=v,I.toUpperFirstLetter=S,I.formatterSpaces=R,I.formatterCaps=T}(void 0===invoxmd?module.exports:invoxmd)}();