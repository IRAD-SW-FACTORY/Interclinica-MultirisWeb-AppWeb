function changeScopeStatus(e,n){if(audioSource.getAccessAllowed())switch(n){case invoxmd.dictationScope.PAUSED:e.execCommand("ChangeStatusBar_Paused");break;case invoxmd.dictationScope.RUNNING:e.execCommand("ChangeStatusBar_Listening");break;case invoxmd.dictationScope.CORRECTION:e.execCommand("ChangeStatusBar_Correction");break;case invoxmd.dictationScope.PHONETIC_TRANSCRIPTION:e.execCommand("ChangeStatusBar_PhoneticTranscription");break;case invoxmd.dictationScope.SPELLING:e.execCommand("ChangeStatusBar_Spelling")}else switch(audioSource.Status){case invoxmd.audioStatus.NOT_ACCESS:e.execCommand("ChangeStatusBar_NotAccess");break;case invoxmd.audioStatus.STARTED:e.execCommand("ChangeStatusBar_"+(imdSession.UseAgent?"AgentWaiting":"FlashWaiting"))}invoxmdWE.ClearUpdateStatusBarTimeout()}function onInvoxLoaded(){invoxmdWE.Connect(!0),invoxmdWE.EnableReconnection()}function notifyChanges(e){invoxmdWE.UpdateUndoStack(),invoxmdWE.SetVisibleText()}function insertText(e,n){e.insertText(n),notifyChanges(e)}function deleteCurrentSelection(e){insertText(e,"")}function closestRange(e){var n=ckeditorTextHelper.getAllText(editor),o=ckeditorTextHelper.getSelectionRange(editor,n.length),t=(o.start+o.end)/2,i=new RegExp("(^|[^A-zÁ-ÿ])("+e+")(?:[^A-zÁ-ÿ]|$)","gi"),d=null,a=null,r=null;for(/\s/.exec(e)&&(n=n.replace(/\s/g," "));null!==(r=i.exec(n))&&r.index<=t;)d=r.index+r[1].length;r&&(a=r.index+r[1].length);var m;if(null===a)m=d;else if(null===d)m=a;else{var c=t-d,s=a-t;m=c<s?d:a}return null!==m?new invoxmd.Range(m,m+e.length):null}var invoxmdWE="undefined"==typeof module?{}:module.exports;!function(e,n){e.TIME_SET_VISIBLE_TEXT_TO_SERVER=2500,e.TIME_MICROPHONE_ALLOWED=500,e.TIME_UPDATE_LBL_MICGAIN=100,e.TIME_TO_CHECK_CONNECTION=2500,e.EditorGrammarRunning=void 0,e.CustomCommandsRunning=[],e.GRAMMAR_CUSTOM_COMMAND_RUNNING_ID="CUSTOM_GRAMMAR_RUNNING",e.EditorGrammarPaused=void 0,e.CustomCommandsPaused=[],e.GRAMMAR_CUSTOM_COMMAND_PAUSED_ID="CUSTOM_GRAMMAR_PAUSED",e.GRAMMAR_DICTADO_ID="DICTADO_TRIGRAMA",e.TIME_TO_UPDATE_STATUSBAR=1500;var o;e.SetUpdateStatusBarTimeout=function(){clearTimeout(o),o=setTimeout(function(){changeScopeStatus(editor,imdSession.Recognizer.CurrentScope)},e.TIME_TO_UPDATE_STATUSBAR)},e.ClearUpdateStatusBarTimeout=function(){clearTimeout(o)};var t=null;e.GetEditor=function(e){var n=e?CKEDITOR.instances[e]:t;return n||window.console.log("[error]: GetEditor return null"),n},e.SetEditor=function(e){var n=CKEDITOR.instances[e];n?t=n:window.console.log("[error]: The instance "+e+" not exists")},e.HideAllInvoxToolbars=function(){for(var e=0;e<Object.keys(CKEDITOR.instances).length;e++)jQuery("#"+CKEDITOR.instances[Object.keys(CKEDITOR.instances)[e]].id+"_top").find(".cke_button__toggledictation").parent().hide()},e.ShowCurrentInvoxToolbar=function(){t?jQuery("#"+t.id+"_top").find(".cke_button__toggledictation").parent().show():window.console.log("[error]: ShowCurrentInvoxToolbar: The editor has not been established")},e.AdaptCKEditorGUI=function(){for(var e=0;e<jQuery(".cke_toolbox_main").length;e++)jQuery(jQuery(".cke_toolbox_main")[e].children[0]).css("width","100%");jQuery(".cke_toolgroup").css("width","100%"),jQuery(".cke_button__help").css("float","right"),jQuery(".cke_button__about_invoxmd").css("float","right"),jQuery(".cke_button__toggledictation_label").text("").css("display","block").css("overflow","hidden").parent().css("width","7em").css("border","1px solid rgba(63, 51, 51, 0.12)")};var i=function(e){jQuery(".cke_bottom").attr("background-paused")||(jQuery(".cke_bottom").attr("background-paused",jQuery(".cke_bottom").css("background")),jQuery(".cke_chrome").attr("border-paused",jQuery(".cke_chrome").css("border")));var n=function(){var e=editor.config.invoxmdRunningBlinkingColor;jQuery("#cke_"+editor.name+" .cke_bottom").is(":animated")||(jQuery("#cke_"+editor.name+" .cke_chrome").css("border-color",e),jQuery("#cke_"+editor.name+" .cke_bottom").css("background",e).animate({opacity:.5},500,function(){jQuery("#cke_"+editor.name+" .cke_bottom").animate({opacity:1},500,n)}));var o=editor.id;d(o)};n()},d=function(e){jQuery(".cke_chrome").not("."+e).css("border",jQuery(".cke_chrome").attr("border-paused")),jQuery(".cke_bottom").not("#"+e+"_bottom").css("background",jQuery(".cke_bottom").attr("background-paused")).css("opacity",1).stop(!0)};e.EnableGUIonRunning=function(){if(editor.config.invoxmdRunningBlinkingColor){-1!=navigator.appVersion.indexOf("MSIE 8")||-1!=navigator.appVersion.indexOf("MSIE 7")||i(editor.config.invoxmdRunningBlinkingColor)}},e.DisableGUIonRunning=function(){if(editor.config.invoxmdRunningBlinkingColor){-1!=navigator.appVersion.indexOf("MSIE 8")||-1!=navigator.appVersion.indexOf("MSIE 7")||d()}},e.AppendText=function(e,n){e&&(t?n&&"unformatted"!=n?t.insertText(e):t.insertHtml(e):window.console.log("[error]: AppendText: The editor has not been established"))};var a="";e.SetVisibleText=function(){if(t){if(imdSession.Recognizer.CurrentScope==invoxmd.dictationScope.RUNNING){var e=ckeditorTextHelper.getAllText(t);e!=a&&(imdSession.Recognizer.setVisibleText(e),a=e)}}else window.console.log("[error]: SetVisibleText: The editor has not been established")};var r=null;e.EnableSetVisibleText=function(){r||(e.SetVisibleText(),r=setInterval(e.SetVisibleText,e.TIME_SET_VISIBLE_TEXT_TO_SERVER))},e.DisableSetVisibleText=function(){r&&(clearInterval(r),r=null)},e.MicActivity=function(){t?t.execCommand("UpdateMicActivity"):window.console.log("[error]: MicActivity: The editor has not been establised")};var m=null;e.EnableMicActivity=function(){m||(e.MicActivity(),m=setInterval(e.MicActivity,e.TIME_UPDATE_LBL_MICGAIN))},e.DisableMicActivity=function(){m&&(clearInterval(m),m=null)},e.UpdateUndoStack=function(){t?t.fire("saveSnapshot"):window.console.log("[error]: UpdateUndoStack: The editor has not been established")},e.UpdateScrollIntoView=function(){if(t){var e=t.getSelection(),n=e.getRanges()[0];e.scrollIntoView(),n.select()}else window.console.log("[error]: UpdateScrollIntoView: The editor has not been established")},e.GetInfo=function(){var e=window.idTarget?window.idTarget:window.name;return e?sessionStorage.setItem("idTarget",e):e=sessionStorage.getItem("idTarget"),window.targets&&window.targets[e]?window.targets[e]:window.opener.targets[e]?window.opener.targets[e]:window.opener.targets.DEFAULT},e.CleanText=function(e){var n=e,o=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE;return o&&e&&(n=e.replace(new RegExp(o,"g"),"")),n},e.AcceptDictation=function(e,n){var o="";if(t){var i=ckeditorTextHelper.getAllText(t),d=ckeditorTextHelper.getSelectionRange(t,i.length),a=i.substr(0,d.start).slice(-10),r=i.substr(d.end,10),m=invoxmd.FormatCase.NORMAL_CASE;n?m=invoxmd.FormatCase.NONE:t.CAPS_ACTIVATE?m=invoxmd.FormatCase.UPPER_CASE:t.INITIAL_CAPS?m=invoxmd.FormatCase.TITLE_CASE:t.FIRST_LETTER_CAPS&&(m=invoxmd.FormatCase.FIRST_CAPITAL);var o=new String(e.Hypothesis.Text);a=this.CleanText(a),r=this.CleanText(r);var c=e.Hypothesis.Words;invoxmd.util.FormatText(imdSession,o,a,r,m,c,function(e,n){invoxmd.exceptionType.NONE==e.ExceptionType?(o=e.FormatText,0===parseInt(e.LeftCharsToDelete)&&0===parseInt(e.RightCharsToDelete)||(d.start-=+e.LeftCharsToDelete,d.end+=+e.RightCharsToDelete,ckeditorTextHelper.setSelectionRange(t,d))):o=invoxmd.Formatter.adaptText(i,d,o,m),ckeditorTextHelper.replaceText(t,o)}),invoxmdWE.UpdateUndoStack(),t.FIRST_LETTER_CAPS&&(t.FIRST_LETTER_CAPS=!1)}else window.console.log("[error]: AcceptDictation: The editor has not been established");return o},e.SetFlashVolume=function(e,n){null!=e.SessionVolume?(audioSource.setVolume(e.SessionVolume),window.console.log("[info]: Set audioSource.setVolume("+e.SessionVolume+") from session volume")):(audioSource.setVolume(e.DefaultVolume),window.console.log("[info]: Set audioSource.setVolume("+e.DefaultVolume+") from default value"))},e.MicAllowed=function(){if(audioSource&&!audioSource.getAccessAllowed())void 0===o&&(o=CKEDITOR.instances[Object.keys(CKEDITOR.instances)[0]]),changeScopeStatus(o,null);else{e.DisableMicAllowed(),imdSession.Recognizer.setScope(invoxmd.dictationScope.PAUSED),imdSession.UseAgent||invoxmdWE.SetFlashVolume(imdSession,audioSource);for(var n=0;n<Object.keys(CKEDITOR.instances).length;n++){var o=CKEDITOR.instances[Object.keys(CKEDITOR.instances)[n]];changeScopeStatus(o,imdSession.Recognizer.CurrentScope)}}};var c=null;e.EnableMicAllowed=function(){c||(e.MicAllowed(),c=setInterval(e.MicAllowed,e.TIME_MICROPHONE_ALLOWED))},e.DisableMicAllowed=function(){c&&(clearInterval(c),c=null)},e.DisableAllIntervals=function(){e.DisableSetVisibleText(),e.DisableMicActivity(),e.DisableMicAllowed(),e.DisableReconnection()},e.Connect=function(e){(e||!imdSession||imdSession.State==invoxmd.sessionState.DISCONNECTED&&document.hasFocus())&&initSession()};var s=null;e.EnableReconnection=function(){s||(s=setInterval(invoxmdWE.Connect,invoxmdWE.TIME_TO_CHECK_CONNECTION))},e.DisableReconnection=function(){s&&(clearInterval(s),s=null)};var l=document.getElementsByTagName("script"),E=l[l.length-1],u=E.src.substring(0,E.src.lastIndexOf("/"))+"/";e.SWFdomId="recorder",e.EmbedSWF=function(n){swfobject.embedSWF(u+"InvoxMD_Support.swf",e.SWFdomId,401,301,"10.0.0",null,null,{menu:"false",wmode:"transparent",allowscriptaccess:"always"},null,n)},e.GetSWF=function(){return jQuery("#"+e.SWFdomId).get(0)}}("undefined"==typeof invoxmd?module.exports:invoxmdWE);var editor,imdSession=null,audioSource=null,enDialogo=!1;Object.keys||(Object.keys=function(e){var n=[];for(var o in e)e.hasOwnProperty(o)&&n.push(o);return n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var n=this.length>>>0,o=Number(arguments[1])||0;for(o=o<0?Math.ceil(o):Math.floor(o),o<0&&(o+=n);o<n;o++)if(o in this&&this[o]===e)return o;return-1}),document.addEventListener&&document.addEventListener("keydown",function(e){for(var n=e.getModifierState("CapsLock"),o=0;o<Object.keys(CKEDITOR.instances).length;o++)CKEDITOR.instances[Object.keys(CKEDITOR.instances)[o]].CAPS_ACTIVATE=n,n&&(CKEDITOR.instances[Object.keys(CKEDITOR.instances)[o]].INITIAL_CAPS=!1)},!1),CKEDITOR.on("instanceReady",function(e){var n=invoxmdWE.GetInfo();if(e.editor.execCommand("ChangeStatusBar_Connecting",n.host),!editor){var o=function(n){if(!n.success){window.console.log("[error]: Ha ocurrido un error al cargar el objeto flash."),e.editor.execCommand("ChangeStatusBar_FlashError");var o={tapToDismiss:!0,preventDuplicates:!0,showDuration:0,timeOut:0,extendedTimeOut:0,onHidden:function(){var e=document.getElementById("recorder"),n=e.getElementsByTagName("a");n.length&&n[0].click()}};toastr.error("Active <strong>aquí</strong> los permisos de ejecución de Flash","",o)}};invoxmdWE.EmbedSWF(o)}editor=e.editor,editor.focus(),editor.focus=function(){},editor.CAPS_ACTIVATE=!1,editor.INITIAL_CAPS=!1,editor.FIRST_LETTER_CAPS=!1,window.console.log("[info]: Instance of CKEditor "+editor.name+" ready."),invoxmdWE.SetEditor(editor.name),invoxmdWE.AppendText(n.text,n.format),invoxmdWE.AdaptCKEditorGUI(),invoxmdWE.HideAllInvoxToolbars(),invoxmdWE.ShowCurrentInvoxToolbar(),e.editor.document.on("keydown",function(e){if(e.data.$.getModifierState)for(var n=e.data.$.getModifierState("CapsLock"),o=0;o<Object.keys(CKEDITOR.instances).length;o++)CKEDITOR.instances[Object.keys(CKEDITOR.instances)[o]].CAPS_ACTIVATE=n,n&&(CKEDITOR.instances[Object.keys(CKEDITOR.instances)[o]].INITIAL_CAPS=!1)}),e.editor.on("doubleclick",function(e){window.console.log("[info]: Receive editor doubleclick on "+e.editor.name),e.editor.fire("click")}),e.editor.on("click",function(e){editor=e.editor,window.console.log("[info]: Receive editor click on "+editor.name),invoxmdWE.SetEditor(editor.name),invoxmdWE.HideAllInvoxToolbars(),invoxmdWE.ShowCurrentInvoxToolbar()}),e.editor.on("focus",function(e){window.console.log("[info]: Receive editor focus on "+e.editor.name),e.editor.fire("click")})});var initSession=function(){var e=invoxmdWE.GetInfo(),n=invoxmdWE.GetSWF(),o=!1;imdSession=new invoxmd.Session(e.host,e.port,!e.agent,!0,n,e.agent),audioSource=imdSession.UseAgent?new invoxmd.AgentAudioSource(imdSession,n):new invoxmd.AudioSource(imdSession,n),imdSession.SessionActEventHandler=function(n){switch(n.Act){case invoxmd.sessionAct.UNKNOWN:break;case invoxmd.sessionAct.LOGIN_GLOBAL_MODEL:case invoxmd.sessionAct.LOGIN_OTHER_GLOBAL:case invoxmd.sessionAct.LOGIN_USER_PROFILE:case invoxmd.sessionAct.LOGIN_OTHER_USER:case invoxmd.sessionAct.LOGIN_DOWNLOADING_RESOURCES:case invoxmd.sessionAct.LOGIN_PREPARING:editor.execCommand("ChangeStatusBar_DownloadingResources");break;case invoxmd.sessionAct.LOGOUT_USER_PROFILE:case invoxmd.sessionAct.LOGOUT_OTHER_USER:editor.execCommand("ChangeStatusBar_SendingResources");break;case invoxmd.sessionAct.INVALID_SESSION:editor.execCommand("ChangeStatusBar_InvalidSession"),invoxmdWE.DisableReconnection(),o=!0;break;case invoxmd.sessionAct.NET_CONNECTION_OK:window.console.log("[info]: Receive NET_CONNECTION_OK"),invoxmdWE.EnableSetVisibleText(),invoxmdWE.EnableMicActivity(),invoxmdWE.EnableMicAllowed(),editor&&editor.execCommand("ChangeStatusBar_Login",e.user),imdSession.SessionKey?window.console.log("[info]: Exist a session cookie after NET_CONNECTION_OK, we reuse the session."):(window.console.log("[info]: Does not exist a session cookie after NET_CONNECTION_OK, we call to LOGIN."),imdSession.login(e.user,e.password));break;case invoxmd.sessionAct.NET_CONNECTION_LOST:window.console.log("[info]: Receive NET_CONNECTION_LOST"),editor.execCommand("ChangeStatusBar_NetConnectionLost"),invoxmdWE.DisableGUIonRunning(),imdSession.SessionKey?(window.console.log("[info]: Exist a session cookie after NET_CONNECTION_LOST, we call to CONNECT with the last session."),imdSession.connect("imdSession")):window.console.log("[info]: Does not exist a session cookie after NET_CONNECTION_LOST, we can't do anything to regain the session.");break;case invoxmd.sessionAct.NET_CONNECTION_DUP:invoxmdWE.DisableGUIonRunning(),window.console.log("[info]: Receive NET_CONNECTION_DUP"),window.console.log("[info]: Detect a CONNECTION_DUP, audio input paused for this window,It will be reconnected when the focus is returned to the window after "+invoxmdWE.TIME_TO_CHECK_CONNECTION+"ms."),o=!0,editor.execCommand("ChangeStatusBar_Reconection");break;case invoxmd.sessionAct.NET_LATENCY_WARNING:case invoxmd.sessionAct.NET_LATENCY_ERROR:editor.execCommand("ChangeStatusBar_NetLatencyError");break;case invoxmd.sessionAct.ROLE_VIOLATION:case invoxmd.sessionAct.ROLE_DOWNGRADE:break;case invoxmd.sessionAct.WEBSOCKET_CLOSED:invoxmdWE.DisableGUIonRunning(),o||editor.execCommand("ChangeStatusBar_WebsocketClosed"),o=!1}},imdSession.ActionHandlerTable[invoxmd.wsMessage.RECOGNIZER_START]=function(e,n){e.ExceptionType==invoxmd.exceptionType.NONE?(n.UseAgent&&(audioSource.LoginComplete=!0),void 0!==invoxmdWE.EditorGrammarRunning&&n.RecognizerEngine.addCommandGrammar(invoxmdWE.EditorGrammarRunning),void 0!==invoxmdWE.EditorGrammarPaused&&n.RecognizerEngine.addCommandGrammar(invoxmdWE.EditorGrammarPaused),enDialogo||n.Recognizer.setScope(invoxmd.dictationScope.PAUSED)):(editor.execCommand("ChangeStatusBar_RecognizerError"),window.console.log("[error]: Recognizer Start Error: ",e))},imdSession.ActionHandlerTable[invoxmd.wsMessage.LOGOUT]=function(e,n){invoxmdWE.DisableAllIntervals(),imdSession.reconnectChangeUser&&(imdSession.reconnectChangeUser=!1,invoxmdWE.Connect(!0))},imdSession.ActionHandlerTable[invoxmd.wsMessage.LOGIN]=function(e,n){e.ExceptionType==invoxmd.exceptionType.NONE?(imdSession.Recognizer.start(audioSource),"function"==typeof onInvoxReady&&onInvoxReady(imdSession),editor.execCommand("ChangeStatusBar_SuccessSession")):(window.console.log("[error]: Login Error: ",e),e.ExceptionType==invoxmd.exceptionType.CREDENTIALS?(editor.execCommand("ChangeStatusBar_InvalidCredentials"),invoxmdWE.DisableAllIntervals()):e.ExceptionType===invoxmd.exceptionType.CONCURRENT_LICENSE?(editor.execCommand("ChangeStatusBar_ConcurrentLicense"),invoxmdWE.DisableAllIntervals()):(editor.execCommand("ChangeStatusBar_Error"),n.State=invoxmd.sessionState.DISCONNECTED))},imdSession.ActionHandlerTable[invoxmd.wsMessage.GET_USER_INFO]=function(n,o){n.ExceptionType==invoxmd.exceptionType.NONE&&(n.User.Login.toLowerCase()!=e.user.toLowerCase()?(imdSession.reconnectChangeUser=!0,imdSession.logout()):(imdSession.Recognizer.start(audioSource),"function"==typeof onInvoxReady&&onInvoxReady(imdSession)))},imdSession.Recognizer.CommandEventHandler=function(e){if(imdCommands[e.CommandId](editor,e)){var n=e.Hypothesis.Text.replace(new RegExp(e.RightHandSide+"$","gi"),'"'+e.RightHandSide+'"');editor.execCommand("ChangeStatusBar_CommandExecuted",n),invoxmdWE.SetUpdateStatusBarTimeout()}},imdSession.Recognizer.CurrentScopeEventHandler=function(e){if(e.CurrentScope!=invoxmd.dictationScope.NONE||enDialogo)switch(changeScopeStatus(editor,e.CurrentScope),e.CurrentScope){case invoxmd.dictationScope.NONE:void 0!==invoxmdWE.EditorGrammarRunning&&imdSession.RecognizerEngine.deactivateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_RUNNING_ID]),void 0!==invoxmdWE.EditorGrammarPaused&&imdSession.RecognizerEngine.deactivateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_PAUSED_ID]);break;case invoxmd.dictationScope.RUNNING:case invoxmd.dictationScope.PHONETIC_TRANSCRIPTION:case invoxmd.dictationScope.SPELLING:case invoxmd.dictationScope.CORRECTION:void 0!==invoxmdWE.EditorGrammarPaused&&imdSession.RecognizerEngine.deactivateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_PAUSED_ID]),void 0!==invoxmdWE.EditorGrammarRunning&&imdSession.RecognizerEngine.activateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_RUNNING_ID]),invoxmdWE.EnableGUIonRunning();break;default:imdSession.RecognizerEngine.activateGrammars([invoxmdWE.GRAMMAR_DICTADO_ID]),void 0!==invoxmdWE.EditorGrammarRunning&&imdSession.RecognizerEngine.deactivateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_RUNNING_ID]),void 0!==invoxmdWE.EditorGrammarPaused&&imdSession.RecognizerEngine.activateGrammars([invoxmdWE.GRAMMAR_CUSTOM_COMMAND_PAUSED_ID]),invoxmdWE.DisableGUIonRunning()}else imdSession.Recognizer.setScope(invoxmd.dictationScope.PAUSED)},imdSession.Recognizer.MicConfigEventHandler=function(e){var n={tapToDismiss:!1,preventDuplicates:!0,showDuration:0,timeOut:6e3},o=toastr.warning("","Ajuste de micrófono necesario",n);!!CKEDITOR.dialog.getCurrent()||editor.execCommand("invoxmd_MicConfig"),void 0!==o&&o.css("opacity",1)},imdSession.Recognizer.TrainingEventHandler=function(e){var n={tapToDismiss:!1,preventDuplicates:!0,showDuration:0,timeOut:6e3},o=toastr.warning("","Realice el entrenamiento para mejorar la calidad del reconocimiento",n);!!CKEDITOR.dialog.getCurrent()||editor.execCommand("invoxmd_Training"),void 0!==o&&o.css("opacity",1)},imdSession.Recognizer.DictationEventHandler=function(e){switch(e.Subtype){case invoxmd.dictationEventType.ACCEPTED:var n="USER_MACROS"==e.Hypothesis.GrammarId||"GLOBAL_MACROS"==e.Hypothesis.GrammarId,o=invoxmdWE.AcceptDictation(e,n);n?editor.execCommand("ChangeStatusBar_Macro",e.MacroSource):editor.execCommand("ChangeStatusBar_AcceptedHypothesis",o),invoxmdWE.SetVisibleText();break;case invoxmd.dictationEventType.PARTIAL:editor.execCommand("ChangeStatusBar_PartialHypothesis",e.Hypothesis.Text);break;case invoxmd.dictationEventType.REJECTED:window.console.log("[warn]: Dictation Event: Hypothesis REJECTED: ",e),editor.execCommand("ChangeStatusBar_RejectedHypothesis","")}invoxmdWE.SetUpdateStatusBarTimeout()},audioSource.ControlDeviceEventHandler=function(e){switch(e.CurrentAction){case invoxmd.controlDeviceAction.NONE:case invoxmd.controlDeviceAction.DEVICE_ADDED:case invoxmd.controlDeviceAction.DEVICE_REMOVED:break;case invoxmd.controlDeviceAction.ACCEPT_TEXT:imdCommands[invoxmd.commandId.ACCEPT_TEXT](editor,null);break;case invoxmd.controlDeviceAction.DELETE_WORDS:imdCommands[invoxmd.commandId.DELETE_WORDS](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_BEGINNING_DOC:imdCommands[invoxmd.commandId.GO_TO_BEGINNING_DOC](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_BEGINNING_PARAGRAPH:imdCommands[invoxmd.commandId.GO_TO_BEGINNING_PARAGRAPH](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_END_DOC:imdCommands[invoxmd.commandId.GO_TO_END_DOC](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_END_PARAGRAPH:imdCommands[invoxmd.commandId.GO_TO_END_PARAGRAPH](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_NEXT_PARAGRAPH:imdCommands[invoxmd.commandId.GO_TO_NEXT_PARAGRAP](editor,null);break;case invoxmd.controlDeviceAction.GO_TO_PREV_PARAGRAPH:imdCommands[invoxmd.commandId.GO_TO_PREV_PARAGRAPH](editor,null);break;case invoxmd.controlDeviceAction.MOVE_BACKWARD:case invoxmd.controlDeviceAction.MOVE_FORWARD:case invoxmd.controlDeviceAction.MOVE_STOP:break;case invoxmd.controlDeviceAction.REDO:imdCommands[invoxmd.commandId.REDO](editor,null);break;case invoxmd.controlDeviceAction.REDO_WORDS:imdCommands[invoxmd.commandId.REDO_WORDS](editor,null);break;case invoxmd.controlDeviceAction.START_DICTATION:imdCommands[invoxmd.commandId.START_DICTATION](editor,null);break;case invoxmd.controlDeviceAction.STOP_DICTATION:imdCommands[invoxmd.commandId.STOP_DICTATION](editor,null);break;case invoxmd.controlDeviceAction.SWITCH_DICTATION:editor.execCommand("ToggleDictation");break;case invoxmd.controlDeviceAction.SWITCH_DOC_LOCK:break;case invoxmd.controlDeviceAction.SWITCH_CAPS_LOCK:var n=editor.CAPS_ACTIVATE?invoxmd.commandId.CAPS_DEACTIVATE:invoxmd.commandId.CAPS_ACTIVATE;imdCommands[n](editor,null);break;case invoxmd.controlDeviceAction.UNDO:imdCommands[invoxmd.commandId.UNDO](editor,null)}};var t=imdSession.RecognizerEngine.CommandSpecBuilder;if(Object.keys(invoxmdWE.CustomCommandsRunning).length>0){var i=[];for(var d in invoxmdWE.CustomCommandsRunning)invoxmdWE.CustomCommandsRunning.hasOwnProperty(d)&&i.push(t.buildText(d));var a=t.buildOptions(i);invoxmdWE.EditorGrammarRunning=new invoxmd.CommandGrammar(invoxmdWE.GRAMMAR_CUSTOM_COMMAND_RUNNING_ID,a),invoxmdWE.EditorGrammarRunning.CommandEventHandler=function(e){var n=invoxmdWE.CustomCommandsRunning[e.Hypothesis.Text];n&&(editor.execCommand("ChangeStatusBar_CommandExecuted",e.Hypothesis.Text),invoxmdWE.SetUpdateStatusBarTimeout(),n())}}if(Object.keys(invoxmdWE.CustomCommandsPaused).length>0){var r=[];for(var d in invoxmdWE.CustomCommandsPaused)invoxmdWE.CustomCommandsPaused.hasOwnProperty(d)&&r.push(t.buildText(d));var m=t.buildOptions(r);invoxmdWE.EditorGrammarPaused=new invoxmd.CommandGrammar(invoxmdWE.GRAMMAR_CUSTOM_COMMAND_PAUSED_ID,m),invoxmdWE.EditorGrammarPaused.CommandEventHandler=function(e){var n=invoxmdWE.CustomCommandsPaused[e.Hypothesis.Text];n&&(editor.execCommand("ChangeStatusBar_CommandExecuted",e.Hypothesis.Text),invoxmdWE.SetUpdateStatusBarTimeout(),n())}}imdSession.connect("imdSession")};!function(){var e=function(e){return function(){editor.getCommand(e).state==CKEDITOR.TRISTATE_ON&&editor.execCommand(e)}},n=function(e){return function(){editor.getCommand(e).state==CKEDITOR.TRISTATE_OFF&&editor.execCommand(e)}};invoxmdWE.CustomCommandsRunning["Activar Negrita"]=n("bold"),invoxmdWE.CustomCommandsRunning["Desactivar Negrita"]=e("bold"),invoxmdWE.CustomCommandsRunning["Activar Itálica"]=n("italic"),invoxmdWE.CustomCommandsRunning["Activar Cursiva"]=n("italic"),invoxmdWE.CustomCommandsRunning["Desactivar Itálica"]=e("italic"),invoxmdWE.CustomCommandsRunning["Desactivar Cursiva"]=e("italic"),invoxmdWE.CustomCommandsRunning["Activar Subrayado"]=n("underline"),invoxmdWE.CustomCommandsRunning["Activar Subrayar"]=n("underline"),invoxmdWE.CustomCommandsRunning["Desactivar Subrayado"]=e("underline"),invoxmdWE.CustomCommandsRunning["Desactivar Subrayar"]=e("underline"),invoxmdWE.CustomCommandsRunning["Abrir Lista"]=n("bulletedlist"),invoxmdWE.CustomCommandsRunning["Iniciar Lista"]=n("bulletedlist"),invoxmdWE.CustomCommandsRunning["Empezar Lista"]=n("bulletedlist"),invoxmdWE.CustomCommandsRunning["Comenzar Lirsta"]=n("bulletedlist"),invoxmdWE.CustomCommandsRunning["Abrir Lista Ordenada"]=n("numberedlist"),invoxmdWE.CustomCommandsRunning["Iniciar Lista Ordenada"]=n("numberedlist"),invoxmdWE.CustomCommandsRunning["Empezar Lista Ordenada"]=n("numberedlist"),invoxmdWE.CustomCommandsRunning["Comenzar Lista Ordenada"]=n("numberedlist");var o=function(){if(editor.getCommand("numberedlist").state==CKEDITOR.TRISTATE_ON||editor.getCommand("bulletedlist").state==CKEDITOR.TRISTATE_ON){for(var e=editor.getSelection().getRanges()[0].startContainer,n=e.getParent();n&&-1==["OL","UL"].indexOf(n.$.nodeName);)n=n.getParent();if(n){if(!n.hasNext()){editor.fire("lockSnapshot");try{n.getParent().appendBogus(!0)}catch(e){}finally{editor.fire("unlockSnapshot")}}var o=editor.createRange(),t=e.type==CKEDITOR.NODE_ELEMENT?e.getChild(0):null;t&&"BR"==t.$.nodeName&&e.remove(),o.setStartBefore(n.getNext()),o.select()}invoxmdWE.UpdateScrollIntoView()}};invoxmdWE.CustomCommandsRunning["Cerrar Lista"]=o,invoxmdWE.CustomCommandsRunning["Salir de la Lista"]=o,invoxmdWE.CustomCommandsRunning["Alinear a la izquierda"]=n("justifyleft"),invoxmdWE.CustomCommandsRunning["Alineado a la izquierda"]=n("justifyleft"),invoxmdWE.CustomCommandsRunning["Alinear a la derecha"]=n("justifyright"),invoxmdWE.CustomCommandsRunning["Alineado a la derecha"]=n("justifyright"),invoxmdWE.CustomCommandsRunning["Centrar texto"]=n("justifycenter"),invoxmdWE.CustomCommandsRunning["Alineado al centro"]=n("justifycenter"),invoxmdWE.CustomCommandsRunning["Justificar texto"]=n("justifyblock")}();var imdCommands=[],range;imdCommands[invoxmd.commandId.ACCEPT_TEXT]=function(e,n){if(!e.isInternal){var o=invoxmdWE.GetInfo();"formatted"==o.format?o.target.innerHTML=e.getData():o.target.value=ckeditorTextHelper.getAllText(e),window.close()}return!e.isInternal},imdCommands[invoxmd.commandId.ACTIVATE_SPELLING]=function(e,n){return imdSession.Recognizer.setScope(invoxmd.dictationScope.SPELLING),e.FIRST_SPELLING=!0,e.execCommand("ShowSpellingWords"),!0},imdCommands[invoxmd.commandId.ALL_CAPS]=function(e,n){var o;if(null!==(o=closestRange(n.RightHandSide))){ckeditorTextHelper.setSelectionRange(e,o);insertText(e,n.RightHandSide.toUpperCase())}return null!==o},imdCommands[invoxmd.commandId.CANCEL_TEMPLATE]=function(e,n){return!1},imdCommands[invoxmd.commandId.CANCEL_TEXT]=function(e,n){return e.isInternal||window.close(),!e.isInternal},imdCommands[invoxmd.commandId.CAPS]=function(e,n){var o;if(null!==(o=closestRange(n.RightHandSide))){ckeditorTextHelper.setSelectionRange(e,o);insertText(e,n.RightHandSide.charAt(0).toUpperCase()+n.RightHandSide.slice(1))}return null!==o},imdCommands[invoxmd.commandId.CAPS_ACTIVATE]=function(e,n){return e.CAPS_ACTIVATE=!0,e.INITIAL_CAPS=!1,!0},imdCommands[invoxmd.commandId.CAPS_DEACTIVATE]=function(e,n){return e.CAPS_ACTIVATE=!1,!0},imdCommands[invoxmd.commandId.CAPS_SELECTION]=function(e,n){return e.execCommand("transformTextToUppercase"),!0},imdCommands[invoxmd.commandId.CLOSE]=function(e,n){return!1},imdCommands[invoxmd.commandId.CORRECT]=function(e,n){var o;if(null!==(o=closestRange(n.RightHandSide))){var t=ckeditorTextHelper.getSelectionRange(e);ckeditorTextHelper.setSelectionRange(e,o);var i=e.getSelection().getSelectedText();e.openDialog("invoxmd_CorrectionDialog",function(e){e.textSelected=i,e.previousPosition=t})}return null!==o},imdCommands[invoxmd.commandId.CORRECT_SELECTION]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length),i=t.expandStart(o,ckeditorTextHelper.WORD_DELIM,!1).expandEnd(o,ckeditorTextHelper.WORD_DELIM,!1);ckeditorTextHelper.setSelectionRange(e,i,o.length);var d=e.getSelection().getSelectedText();return e.openDialog("invoxmd_CorrectionDialog",function(e){e.textSelected=d,e.previousPosition=t}),!0},imdCommands[invoxmd.commandId.DEACTIVATE_SPELLING]=function(e,n){return imdSession.Recognizer.setScope(invoxmd.dictationScope.RUNNING),e.execCommand("HideSpellingWords"),!0},imdCommands[invoxmd.commandId.DELETE]=function(e,n){var o;return null!==(o=closestRange(n.RightHandSide))&&(ckeditorTextHelper.setSelectionRange(e,o),deleteCurrentSelection(e)),null!==o},imdCommands[invoxmd.commandId.DELETE_NEXT_PARAGRAPH]=function(e,n){return imdCommands[invoxmd.commandId.SELECT_NEXT_PARAGRAPH](e,n),deleteCurrentSelection(e),!0},imdCommands[invoxmd.commandId.DELETE_NEXT_SENTENCE]=function(e,n){return imdCommands[invoxmd.commandId.SELECT_NEXT_SENTENCE](e,n),deleteCurrentSelection(e),!0},imdCommands[invoxmd.commandId.DELETE_PREV_PARAGRAPH]=function(e,n){return imdCommands[invoxmd.commandId.SELECT_PREV_PARAGRAPH](e,n),deleteCurrentSelection(e),!0},imdCommands[invoxmd.commandId.DELETE_PREV_SENTENCE]=function(e,n){return imdCommands[invoxmd.commandId.SELECT_PREV_SENTENCE](e,n),deleteCurrentSelection(e),!0},imdCommands[invoxmd.commandId.DELETE_SELECTION]=function(e,n){return deleteCurrentSelection(e),!0},imdCommands[invoxmd.commandId.DELETE_WORDS]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO]=function(e,n){var o;return null!==(o=closestRange(n.RightHandSide))&&(ckeditorTextHelper.setSelectionRange(e,o.collapseStart()),invoxmdWE.UpdateScrollIntoView()),null!==o},imdCommands[invoxmd.commandId.GO_TO_AFTER]=function(e,n){var o;return null!==(o=closestRange(n.RightHandSide))&&(ckeditorTextHelper.setSelectionRange(e,o.collapseEnd()),invoxmdWE.UpdateScrollIntoView()),null!==o},imdCommands[invoxmd.commandId.GO_TO_BEGINNING_DOC]=function(e,n){var o=new invoxmd.Range(0);return ckeditorTextHelper.setSelectionRange(e,o),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_BEGINNING_PARAGRAPH]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.PARAGRAPH_DELIM,!1).collapseStart();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_BEGINNING_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.SENTENCE_DELIM,!1).collapseStart();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_BOOKMARK]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO_END_DOC]=function(e,n){var o=new invoxmd.Range(ckeditorTextHelper.getAllText(e).length-1);return ckeditorTextHelper.setSelectionRange(e,o),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_END_PARAGRAPH]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandEnd(o,ckeditorTextHelper.PARAGRAPH_DELIM,!1).collapseEnd();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_END_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandEnd(o,ckeditorTextHelper.SENTENCE_DELIM,!1).collapseEnd();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_NEXT_FIELD]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO_NEXT_GROUP]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO_NEXT_PARAGRAPH]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandEnd(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0).collapseEnd();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_NEXT_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandEnd(o,ckeditorTextHelper.SENTENCE_DELIM,!0).collapseEnd();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_PREV_FIELD]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO_PREV_GROUP]=function(e,n){return!1},imdCommands[invoxmd.commandId.GO_TO_PREV_PARAGRAPH]=function(e,n){
var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0).expandStart(o,ckeditorTextHelper.PARAGRAPH_DELIM,!1).collapseStart();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.GO_TO_PREV_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.SENTENCE_DELIM,!0).expandStart(o,ckeditorTextHelper.SENTENCE_DELIM,!1).collapseStart();return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.INITIAL_CAPS_ACTIVATE]=function(e,n){return e.INITIAL_CAPS=!0,e.CAPS_ACTIVATE=!1,!0},imdCommands[invoxmd.commandId.INITIAL_CAPS_DEACTIVATE]=function(e,n){return e.INITIAL_CAPS=!1,!0},imdCommands[invoxmd.commandId.MENU]=function(e,n){return!1},imdCommands[invoxmd.commandId.NEW_REPORT]=function(e,n){return!1},imdCommands[invoxmd.commandId.NO_CAPS]=function(e,n){var o;return null!==(o=closestRange(n.RightHandSide))&&(ckeditorTextHelper.setSelectionRange(e,o),insertText(e,n.RightHandSide.toLowerCase())),null!==o},imdCommands[invoxmd.commandId.NORMALIZE_SELECTION]=function(e,n){return e.execCommand("transformTextToLowercase"),!0},imdCommands[invoxmd.commandId.REDO]=function(e,n){return e.execCommand("redo"),invoxmdWE.SetVisibleText(),!0},imdCommands[invoxmd.commandId.REDO_WORDS]=function(e,n){return!1},imdCommands[invoxmd.commandId.SAVE]=function(e,n){return!1},imdCommands[invoxmd.commandId.SAVE_REPORT]=function(e,n){return!0},imdCommands[invoxmd.commandId.SELECT]=function(e,n){var o;return null!==(o=closestRange(n.RightHandSide))&&(ckeditorTextHelper.setSelectionRange(e,o),invoxmdWE.UpdateScrollIntoView()),null!==o},imdCommands[invoxmd.commandId.SELECT_ALL]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=new invoxmd.Range(0,o.length-1);return ckeditorTextHelper.setSelectionRange(e,t,o.length),!0},imdCommands[invoxmd.commandId.SELECT_NEXT_PARAGRAPH]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).collapseStart().expandEnd(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0).collapseEnd().expandEnd(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0);return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.SELECT_NEXT_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).collapseStart().expandEnd(o,ckeditorTextHelper.SENTENCE_DELIM,!0).collapseEnd().expandEnd(o,ckeditorTextHelper.SENTENCE_DELIM,!0);return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.SELECT_PREV_PARAGRAPH]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0).collapseStart().expandStart(o,ckeditorTextHelper.PARAGRAPH_DELIM,!1).expandEnd(o,ckeditorTextHelper.PARAGRAPH_DELIM,!0);return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.SELECT_PREV_SENTENCE]=function(e,n){var o=ckeditorTextHelper.getAllText(e),t=ckeditorTextHelper.getSelectionRange(e,o.length).expandStart(o,ckeditorTextHelper.SENTENCE_DELIM,!0).collapseStart().expandStart(o,ckeditorTextHelper.SENTENCE_DELIM,!1).expandEnd(o,ckeditorTextHelper.SENTENCE_DELIM,!0);return ckeditorTextHelper.setSelectionRange(e,t,o.length),invoxmdWE.UpdateScrollIntoView(),!0},imdCommands[invoxmd.commandId.SELECT_TEMPLATE]=function(e,n){return!1},imdCommands[invoxmd.commandId.START_DICTATION]=function(e,n){if(!imdSession.UseOnlyButtons||!n){var o=imdSession.Recognizer.CurrentScope==invoxmd.dictationScope.RUNNING||imdSession.Recognizer.CurrentScope==invoxmd.dictationScope.SPELLING;return!o&&e.execCommand("ToggleDictation"),!o}return!1},imdCommands[invoxmd.commandId.START_REPRODUCTION]=function(e,n){return!1},imdCommands[invoxmd.commandId.STOP_DICTATION]=function(e,n){if(!imdSession.UseOnlyButtons||!n){var o=imdSession.Recognizer.CurrentScope==invoxmd.dictationScope.PAUSED;return!o&&e.execCommand("ToggleDictation"),!o}return!1},imdCommands[invoxmd.commandId.STOP_REPRODUCTION]=function(e,n){return!1},imdCommands[invoxmd.commandId.TABULATION]=function(e,n){return insertText(e,"\t"),!0},imdCommands[invoxmd.commandId.UNDO]=function(e,n){return e.execCommand("undo"),invoxmdWE.SetVisibleText(),!0},imdCommands[invoxmd.commandId.UNSELECT]=function(e,n){var o=ckeditorTextHelper.getSelectionRange(e);return o.collapsed()||(o.offsetEnd(1).collapseEnd(),ckeditorTextHelper.setSelectionRange(e,o)),o.collapsed()},imdCommands[invoxmd.commandId.CAPS_INLINE]=function(e,n){return e.FIRST_LETTER_CAPS=!0,!0};var ckeditorTextHelper=function(){function e(e){var n="";return e&&(e.type==CKEDITOR.NODE_ELEMENT&&"p"==e.getName()?n="\n":e.type==CKEDITOR.NODE_ELEMENT&&(-1!=["br","ht"].indexOf(e.getName())||e.isBlockBoundary()&&e.isEditable())?n="\n":e.type==CKEDITOR.NODE_TEXT&&(n=e.getText())),n}function n(e){var n=e.createRange();n.selectNodeContents(e.document.getBody());var o=new CKEDITOR.dom.walker(n);return o.evaluator=CKEDITOR.dom.walker.bogus(!0),o}function o(n,o,t,i){var d=n.createRange(),a=null;for(d.selectNodeContents(n.document.getBody()),o.endContainer.type===CKEDITOR.NODE_TEXT?d.setStartAt(o.endContainer,CKEDITOR.POSITION_BEFORE_START):d.setStart(o.endContainer,o.endOffset),t.range=d,t.evaluator=CKEDITOR.dom.walker.bogus(!0);a=t.previous();)t.remaining=t.remaining-e(a).length;i.end=t.remaining+(o.endContainer.type===CKEDITOR.NODE_TEXT?o.endOffset:0)}function t(n,o,t,i){if(o.collapsed)i.collapseEnd();else{var d=t.range,a=null;for(d.collapse(!0),o.startContainer.type===CKEDITOR.NODE_TEXT?d.setStartAt(o.startContainer,CKEDITOR.POSITION_BEFORE_START):d.setStart(o.startContainer,o.startOffset),t.reset(),t.range=d,t.evaluator=CKEDITOR.dom.walker.bogus(!0);a=t.previous();)t.remaining=t.remaining-e(a).length;i.start=t.remaining+(o.startContainer.type===CKEDITOR.NODE_TEXT?o.startOffset:0)}}function i(e,n){var o=new invoxmd.Range(n-1);r.setSelectionRange(e,o)}function d(n,o,t,i){var d=o.previous();do{o.remaining=o.remaining-e(d).length}while(o.remaining>n.end&&(d=o.previous()));d?d.type==CKEDITOR.NODE_ELEMENT?t.setEndAt(d,d.isEditable()?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START):t.setEnd(d,n.end-o.remaining):t.setEndAt(i.document.getBody().getChild(0),CKEDITOR.POSITION_AFTER_START)}function a(n,o,t,i){if(n.collapsed())t.collapse(!1);else{var d=o.current;o.remaining+=e(d).length;do{o.remaining=o.remaining-e(d).length}while(o.remaining>n.start&&(d=o.previous()));d?d.type==CKEDITOR.NODE_ELEMENT?t.setStartAt(d,d.isEditable()?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START):t.setStart(d,n.start-o.remaining):t.setStartAt(i.document.getBody().getChild(0),CKEDITOR.POSITION_AFTER_START)}}var r={};r.WORD_DELIM=/[^A-zÀ-ÿ0-9]/g,r.SENTENCE_DELIM=/\.\n|\.|\n\n|\n/g,r.PARAGRAPH_DELIM=/\n\n/g,r.getText=function(e,n){return n.start<n.end?(text=this.getAllText(e),text.substr(Math.Max(0,n.start),Math.Min(n.end,text.length-1))):""},r.getAllText=function(o){var t="";if(o){for(var i=o.lockSelection(),d=n(o);node=d.previous();)t=e(node)+t;i&&o.unlockSelection()}return t},r.getSelectionRange=function(e,n){var d=e.lockSelection();void 0==n&&(n=r.getAllText(e).length);var a=e.getSelection().getRanges(!0)[0];void 0==a&&(i(e,n),a=e.getSelection().getRanges(!0)[0]);var m=new invoxmd.Range(0,0),c=new CKEDITOR.dom.walker;return c.remaining=n,a&&(o(e,a,c,m),t(e,a,c,m)),d&&e.unlockSelection(),m},r.getNodeRange=function(e,o,t){var i=e.lockSelection(),r=n(e),m=e.createRange();return r.remaining=void 0!==t?t:this.getAllText(e).length,d(o,r,m,e),a(o,r,m,e),i&&e.unlockSelection(),m};return r.setSelectionRange=function(e,n,o){r.getNodeRange(e,n,o).select()},r.replaceText=function(e,n){var o=n.split("\n"),t=0;do{e.insertText(o[t]),e.fire("saveSnapshot")}while(void 0!==o[++t]&&e.execCommand("enter"))},r}();